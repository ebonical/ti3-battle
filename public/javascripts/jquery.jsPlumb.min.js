/*
 * jsPlumb
 * 
 * Title:jsPlumb 1.3.15
 * 
 * Provides a way to visually connect elements on an HTML page, using either SVG, Canvas
 * elements, or VML.  
 * 
 * This file contains the util functions
 *
 * Copyright (c) 2010 - 2012 Simon Porritt (http://jsplumb.org)
 * 
 * http://jsplumb.org
 * http://github.com/sporritt/jsplumb
 * http://code.google.com/p/jsplumb
 * 
 * Dual licensed under the MIT and GPL2 licenses.
 */jsPlumbUtil={isArray:function(e){return Object.prototype.toString.call(e)==="[object Array]"},isString:function(e){return typeof e=="string"},isBoolean:function(e){return typeof e=="boolean"},isObject:function(e){return Object.prototype.toString.call(e)==="[object Object]"},isDate:function(e){return Object.prototype.toString.call(e)==="[object Date]"},isFunction:function(e){return Object.prototype.toString.call(e)==="[object Function]"},clone:function(e){if(this.isString(e))return new String(e);if(this.isBoolean(e))return new Boolean(e);if(this.isDate(e))return new Date(e.getTime());if(this.isFunction(e))return e;if(this.isArray(e)){var t=[];for(var n=0;n<e.length;n++)t.push(this.clone(e[n]));return t}if(this.isObject(e)){var t={};for(var n in e)t[n]=this.clone(e[n]);return t}return e},merge:function(e,t){var n=this.clone(e);for(var r in t)if(n[r]==null||this.isString(t[r])||this.isBoolean(t[r]))n[r]=t[r];else if(this.isArray(t[r])&&this.isArray(n[r])){var i=[];i.push.apply(i,n[r]),i.push.apply(i,t[r]),n[r]=i}else if(this.isObject(n[r])&&this.isObject(t[r]))for(var s in t[r])n[r][s]=t[r][s];return n},convertStyle:function(e,t){if("transparent"===e)return e;var n=e,r=function(e){return e.length==1?"0"+e:e},i=function(e){return r(Number(e).toString(16))},s=/(rgb[a]?\()(.*)(\))/;if(e.match(s)){var o=e.match(s)[2].split(",");n="#"+i(o[0])+i(o[1])+i(o[2]),!t&&o.length==4&&(n+=i(o[3]))}return n},gradient:function(e,t){return e=jsPlumbUtil.isArray(e)?e:[e.x,e.y],t=jsPlumbUtil.isArray(t)?t:[t.x,t.y],(t[1]-e[1])/(t[0]-e[0])},normal:function(e,t){return-1/jsPlumbUtil.gradient(e,t)},lineLength:function(e,t){return e=jsPlumbUtil.isArray(e)?e:[e.x,e.y],t=jsPlumbUtil.isArray(t)?t:[t.x,t.y],Math.sqrt(Math.pow(t[1]-e[1],2)+Math.pow(t[0]-e[0],2))},segment:function(e,t){return e=jsPlumbUtil.isArray(e)?e:[e.x,e.y],t=jsPlumbUtil.isArray(t)?t:[t.x,t.y],t[0]>e[0]?t[1]>e[1]?2:1:t[1]>e[1]?3:4},intersects:function(e,t){var n=e.x,r=e.x+e.w,i=e.y,s=e.y+e.h,o=t.x,u=t.x+t.w,a=t.y,f=t.y+t.h;return n<=o&&o<=r&&i<=a&&a<=s||n<=u&&u<=r&&i<=a&&a<=s||n<=o&&o<=r&&i<=f&&f<=s||n<=u&&o<=r&&i<=f&&f<=s||o<=n&&n<=u&&a<=i&&i<=f||o<=r&&r<=u&&a<=i&&i<=f||o<=n&&n<=u&&a<=s&&s<=f||o<=r&&n<=u&&a<=s&&s<=f},segmentMultipliers:[null,[1,-1],[1,1],[-1,1],[-1,-1]],inverseSegmentMultipliers:[null,[-1,-1],[-1,1],[1,1],[1,-1]],pointOnLine:function(e,t,n){var r=jsPlumbUtil.gradient(e,t),i=jsPlumbUtil.segment(e,t),s=n>0?jsPlumbUtil.segmentMultipliers[i]:jsPlumbUtil.inverseSegmentMultipliers[i],o=Math.atan(r),u=Math.abs(n*Math.sin(o))*s[1],a=Math.abs(n*Math.cos(o))*s[0];return{x:e.x+a,y:e.y+u}},perpendicularLineTo:function(e,t,n){var r=jsPlumbUtil.gradient(e,t),i=Math.atan(-1/r),s=n/2*Math.sin(i),o=n/2*Math.cos(i);return[{x:t.x+o,y:t.y+s},{x:t.x-o,y:t.y-s}]},findWithFunction:function(e,t){if(e)for(var n=0;n<e.length;n++)if(t(e[n]))return n;return-1},indexOf:function(e,t){return jsPlumbUtil.findWithFunction(e,function(e){return e==t})},removeWithFunction:function(e,t){var n=jsPlumbUtil.findWithFunction(e,t);return n>-1&&e.splice(n,1),n!=-1},remove:function(e,t){var n=jsPlumbUtil.indexOf(e,t);return n>-1&&e.splice(n,1),n!=-1},addWithFunction:function(e,t,n){jsPlumbUtil.findWithFunction(e,n)==-1&&e.push(t)},addToList:function(e,t,n){var r=e[t];return r==null&&(r=[],e[t]=r),r.push(n),r},EventGenerator:function(){var e={},t=this,n=["ready"];this.bind=function(n,r){return jsPlumbUtil.addToList(e,n,r),t},this.fire=function(r,i,s){if(e[r])for(var o=0;o<e[r].length;o++)if(jsPlumbUtil.findWithFunction(n,function(e){return e===r})!=-1)e[r][o](i,s);else try{e[r][o](i,s)}catch(u){jsPlumbUtil.log("jsPlumb: fire failed for event "+r+" : "+u)}return t},this.unbind=function(n){return n?delete e[n]:e={},t},this.getListener=function(t){return e[t]}},logEnabled:!0,log:function(){if(jsPlumbUtil.logEnabled&&typeof console!="undefined")try{var e=arguments[arguments.length-1];console.log(e)}catch(t){}},group:function(e){jsPlumbUtil.logEnabled&&typeof console!="undefined"&&console.group(e)},groupEnd:function(e){jsPlumbUtil.logEnabled&&typeof console!="undefined"&&console.groupEnd(e)},time:function(e){jsPlumbUtil.logEnabled&&typeof console!="undefined"&&console.time(e)},timeEnd:function(e){jsPlumbUtil.logEnabled&&typeof console!="undefined"&&console.timeEnd(e)}},function(){var e=!!document.createElement("canvas").getContext,t=!!window.SVGAngle||document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1"),n=function(){if(n.vml==undefined){var e=document.body.appendChild(document.createElement("div"));e.innerHTML='<v:shape id="vml_flag1" adj="1" />';var t=e.firstChild;t.style.behavior="url(#default#VML)",n.vml=t?typeof t.adj=="object":!0,e.parentNode.removeChild(e)}return n.vml},r=function(e){var t={},n=[],r={},i={};this.register=function(s){var o=jsPlumb.CurrentLibrary;s=o.getElementObject(s);var u=e.getId(s),a=o.getDOMElement(s),f=o.getOffset(s);t[u]||(t[u]=s,n.push(s),r[u]={});var l=function(t,n){if(t)for(var s=0;s<t.childNodes.length;s++)if(t.childNodes[s].nodeType!=3){var a=o.getElementObject(t.childNodes[s]),c=e.getId(a,null,!0);if(c&&i[c]&&i[c]>0){var h=o.getOffset(a);r[u][c]={id:c,offset:{left:h.left-f.left,top:h.top-f.top}}}l(t.childNodes[s])}};l(a)},this.endpointAdded=function(n){var s=jsPlumb.CurrentLibrary,o=document.body,u=e.getId(n),a=s.getDOMElement(n),f=a.parentNode,l=f==o;i[u]=i[u]?i[u]+1:1;while(f!=o){var c=e.getId(f,null,!0);if(c&&t[c]){var h=-1,p=s.getElementObject(f),d=s.getOffset(p);if(r[c][u]==null){var v=jsPlumb.CurrentLibrary.getOffset(n);r[c][u]={id:u,offset:{left:v.left-d.left,top:v.top-d.top}}}break}f=f.parentNode}},this.endpointDeleted=function(e){if(i[e.elementId]){i[e.elementId]--;if(i[e.elementId]<=0)for(var t in r)delete r[t][e.elementId]}},this.getElementsForDraggable=function(e){return r[e]},this.reset=function(){t={},n=[],r={},i={}}};window.console||(window.console={time:function(){},timeEnd:function(){},group:function(){},groupEnd:function(){},log:function(){}}),window.jsPlumbAdapter={headless:!1,appendToRoot:function(e){document.body.appendChild(e)},getRenderModes:function(){return["canvas","svg","vml"]},isRenderModeAvailable:function(r){return{canvas:e,svg:t,vml:n()}[r]},getDragManager:function(e){return new r(e)},setRenderMode:function(e){var t;if(e){e=e.toLowerCase();var n=this.isRenderModeAvailable("canvas"),r=this.isRenderModeAvailable("svg"),i=this.isRenderModeAvailable("vml");e==="svg"?r?t="svg":n?t="canvas":i&&(t="vml"):e==="canvas"&&n?t="canvas":i&&(t="vml")}return t}}}(),function(){var e=jsPlumbUtil.findWithFunction,t=jsPlumbUtil.indexOf,n=jsPlumbUtil.removeWithFunction,r=jsPlumbUtil.remove,i=jsPlumbUtil.addWithFunction,s=jsPlumbUtil.addToList,o=jsPlumbUtil.isArray,u=jsPlumbUtil.isString,a=jsPlumbUtil.isObject,f=null,l=function(e,t){return O.CurrentLibrary.getAttribute(v(e),t)},c=function(e,t,n){O.CurrentLibrary.setAttribute(v(e),t,n)},h=function(e,t){O.CurrentLibrary.addClass(v(e),t)},p=function(e,t){return O.CurrentLibrary.hasClass(v(e),t)},d=function(e,t){O.CurrentLibrary.removeClass(v(e),t)},v=function(e){return O.CurrentLibrary.getElementObject(e)},m=function(e,t){var n=O.CurrentLibrary.getOffset(v(e));if(t!=null){var r=t.getZoom();return{left:n.left/r,top:n.top/r}}return n},g=function(e){return O.CurrentLibrary.getSize(v(e))},y=jsPlumbUtil.log,b=jsPlumbUtil.group,w=jsPlumbUtil.groupEnd,E=jsPlumbUtil.time,S=jsPlumbUtil.timeEnd,x=function(){return""+(new Date).getTime()},T=function(e){var t=this,n=arguments,r=!1,i=e.parameters||{},s=t.idPrefix,o=s+(new Date).getTime(),u=null,a=null;t._jsPlumb=e._jsPlumb,t.getId=function(){return o},t.tooltip=e.tooltip,t.hoverClass=e.hoverClass||t._jsPlumb.Defaults.HoverClass||O.Defaults.HoverClass,jsPlumbUtil.EventGenerator.apply(this),this.clone=function(){var e=new Object;return t.constructor.apply(e,n),e},this.getParameter=function(e){return i[e]},this.getParameters=function(){return i},this.setParameter=function(e,t){i[e]=t},this.setParameters=function(e){i=e},this.overlayPlacements=[];var f=e.beforeDetach;this.isDetachAllowed=function(e){var n=t._jsPlumb.checkCondition("beforeDetach",e);if(f)try{n=f(e)}catch(r){y("jsPlumb: beforeDetach callback failed",r)}return n};var l=e.beforeDrop;this.isDropAllowed=function(e,n,r,i,s){var o=t._jsPlumb.checkCondition("beforeDrop",{sourceId:e,targetId:n,scope:r,connection:i,dropEndpoint:s});if(l)try{o=l({sourceId:e,targetId:n,scope:r,connection:i,dropEndpoint:s})}catch(u){y("jsPlumb: beforeDrop callback failed",u)}return o};var c=function(){if(u&&a){var e={};O.extend(e,u),O.extend(e,a),delete t.hoverPaintStyle,e.gradient&&u.fillStyle&&delete e.gradient,a=e}};this.setPaintStyle=function(e,n){u=e,t.paintStyleInUse=u,c(),n||t.repaint()},this.getPaintStyle=function(){return u},this.setHoverPaintStyle=function(e,n){a=e,c(),n||t.repaint()},this.getHoverPaintStyle=function(){return a},this.setHover=function(e,n,i){!t._jsPlumb.currentlyDragging&&!t._jsPlumb.isHoverSuspended()&&(r=e,t.hoverClass!=null&&t.canvas!=null&&(e?p.addClass(t.canvas,t.hoverClass):p.removeClass(t.canvas,t.hoverClass)),a!=null&&(t.paintStyleInUse=e?a:u,i=i||x(),t.repaint({timestamp:i,recalc:!1})),t.getAttachedElements&&!n&&b(e,x(),t))},this.isHover=function(){return r};var h=null;this.setZIndex=function(e){h=e},this.getZIndex=function(){return h};var p=O.CurrentLibrary,d=["click","dblclick","mouseenter","mouseout","mousemove","mousedown","mouseup","contextmenu"],v={mouseout:"mouseexit"},m=function(e,t,n){var r=v[n]||n;p.bind(e,n,function(e){t.fire(r,t,e)})},g=function(e,t){var n=v[t]||t;p.unbind(e,t)};this.attachListeners=function(e,t){for(var n=0;n<d.length;n++)m(e,t,d[n])};var b=function(e,n,r){var i=t.getAttachedElements();if(i)for(var s=0;s<i.length;s++)(!r||r!=i[s])&&i[s].setHover(e,!0,n)};this.reattachListenersForElement=function(e){if(arguments.length>1){for(var n=0;n<d.length;n++)g(e,d[n]);for(var n=1;n<arguments.length;n++)t.attachListeners(e,arguments[n])}};var w=[],E=function(e){return e==null?null:e.split(" ")},S=function(e){if(t.getDefaultType){var n=t.getTypeDescriptor(),r=jsPlumbUtil.merge({},t.getDefaultType());for(var i=0;i<w.length;i++)r=jsPlumbUtil.merge(r,t._jsPlumb.getType(w[i],n));t.applyType(r),e||t.repaint()}};t.setType=function(e,t){w=E(e)||[],S(t)},t.getType=function(){return w},t.hasType=function(e){return jsPlumbUtil.indexOf(w,e)!=-1},t.addType=function(e,n){var r=E(e),i=!1;if(r!=null){for(var s=0;s<r.length;s++)t.hasType(r[s])||(w.push(r[s]),i=!0);i&&S(n)}},t.removeType=function(e,t){var n=E(e),r=!1,i=function(e){var t=jsPlumbUtil.indexOf(w,e);return t!=-1?(w.splice(t,1),!0):!1};if(n!=null){for(var s=0;s<n.length;s++)r=i(n[s])||r;r&&S(t)}},t.toggleType=function(e,t){var n=E(e);if(n!=null){for(var r=0;r<n.length;r++){var i=jsPlumbUtil.indexOf(w,n[r]);i!=-1?w.splice(i,1):w.push(n[r])}S(t)}},this.applyType=function(e){t.setPaintStyle(e.paintStyle),t.setHoverPaintStyle(e.hoverPaintStyle);if(e.parameters)for(var n in e.parameters)t.setParameter(n,e.parameters[n])}},N=function(e){T.apply(this,arguments);var t=this;this.overlays=[];var n=function(e){var n=null;if(o(e)){var r=e[0],i=O.extend({component:t,_jsPlumb:t._jsPlumb},e[1]);e.length==3&&O.extend(i,e[2]),n=new(O.Overlays[t._jsPlumb.getRenderMode()][r])(i);if(i.events)for(var s in i.events)n.bind(s,i.events[s])}else e.constructor==String?n=new(O.Overlays[t._jsPlumb.getRenderMode()][e])({component:t,_jsPlumb:t._jsPlumb}):n=e;t.overlays.push(n)},r=function(e){var n=t.defaultOverlayKeys||[],r=e.overlays,i=function(e){return t._jsPlumb.Defaults[e]||O.Defaults[e]||[]};r||(r=[]);for(var s=0;s<n.length;s++)r.unshift.apply(r,i(n[s]));return r},i=r(e);if(i)for(var s=0;s<i.length;s++)n(i[s]);var u=function(e){var n=-1;for(var r=0;r<t.overlays.length;r++)if(e===t.overlays[r].id){n=r;break}return n};this.addOverlay=function(e,r){n(e),r||t.repaint()},this.getOverlay=function(e){var n=u(e);return n>=0?t.overlays[n]:null},this.getOverlays=function(){return t.overlays},this.hideOverlay=function(e){var n=t.getOverlay(e);n&&n.hide()},this.hideOverlays=function(){for(var e=0;e<t.overlays.length;e++)t.overlays[e].hide()},this.showOverlay=function(e){var n=t.getOverlay(e);n&&n.show()},this.showOverlays=function(){for(var e=0;e<t.overlays.length;e++)t.overlays[e].show()},this.removeAllOverlays=function(){for(var e=0;e<t.overlays.length;e++)t.overlays[e].cleanup&&t.overlays[e].cleanup();t.overlays.splice(0,t.overlays.length),t.repaint()},this.removeOverlay=function(e){var n=u(e);if(n!=-1){var r=t.overlays[n];r.cleanup&&r.cleanup(),t.overlays.splice(n,1)}},this.removeOverlays=function(){for(var e=0;e<arguments.length;e++)t.removeOverlay(arguments[e])};var a="__label",f=function(e){var n={cssClass:e.cssClass,labelStyle:this.labelStyle,id:a,component:t,_jsPlumb:t._jsPlumb},r=O.extend(n,e);return new(O.Overlays[t._jsPlumb.getRenderMode()].Label)(r)};if(e.label){var l=e.labelLocation||t.defaultLabelLocation||.5,c=e.labelStyle||t._jsPlumb.Defaults.LabelStyle||O.Defaults.LabelStyle;this.overlays.push(f({label:e.label,location:l,labelStyle:c}))}this.setLabel=function(e){var n=t.getOverlay(a);if(!n){var r=e.constructor==String||e.constructor==Function?{label:e}:e;n=f(r),this.overlays.push(n)}else e.constructor==String||e.constructor==Function?n.setLabel(e):(e.label&&n.setLabel(e.label),e.location&&n.setLocation(e.location));t._jsPlumb.isSuspendDrawing()||t.repaint()},this.getLabel=function(){var e=t.getOverlay(a);return e!=null?e.getLabel():null},this.getLabelOverlay=function(){return t.getOverlay(a)};var h=this.applyType;this.applyType=function(e){h(e),t.removeAllOverlays();if(e.overlays)for(var n=0;n<e.overlays.length;n++)t.addOverlay(e.overlays[n],!0)}},C=function(e,t,n){e.bind("click",function(e,n){t.fire("click",t,n)}),e.bind("dblclick",function(e,n){t.fire("dblclick",t,n)}),e.bind("contextmenu",function(e,n){t.fire("contextmenu",t,n)}),e.bind("mouseenter",function(e,r){t.isHover()||(n(!0),t.fire("mouseenter",t,r))}),e.bind("mouseexit",function(e,r){t.isHover()&&(n(!1),t.fire("mouseexit",t,r))})},k=0,L=function(){var e=k+1;return k++,e},A=function(r){this.Defaults={Anchor:"BottomCenter",Anchors:[null,null],ConnectionsDetachable:!0,ConnectionOverlays:[],Connector:"Bezier",ConnectorZIndex:null,Container:null,DragOptions:{},DropOptions:{},Endpoint:"Dot",EndpointOverlays:[],Endpoints:[null,null],EndpointStyle:{fillStyle:"#456"},EndpointStyles:[null,null],EndpointHoverStyle:null,EndpointHoverStyles:[null,null],HoverPaintStyle:null,LabelStyle:{color:"black"},LogEnabled:!1,Overlays:[],MaxConnections:1,PaintStyle:{lineWidth:8,strokeStyle:"#456"},ReattachConnections:!1,RenderMode:"svg",Scope:"jsPlumb_DefaultScope"},r&&O.extend(this.Defaults,r),this.logEnabled=this.Defaults.LogEnabled;var s={},p={};this.registerConnectionType=function(e,t){s[e]=O.extend({},t)},this.registerConnectionTypes=function(e){for(var t in e)s[t]=O.extend({},e[t])},this.registerEndpointType=function(e,t){p[e]=O.extend({},t)},this.registerEndpointTypes=function(e){for(var t in e)p[t]=O.extend({},e[t])},this.getType=function(e,t){return t==="connection"?s[e]:p[e]},jsPlumbUtil.EventGenerator.apply(this);var b=this,w=L(),E=b.bind,S={},k=1;this.setZoom=function(e,t){k=e,t&&b.repaintEverything()},this.getZoom=function(){return k};for(var A in this.Defaults)S[A]=this.Defaults[A];this.bind=function(e,t){"ready"===e&&D?t():E.apply(b,[e,t])},b.importDefaults=function(e){for(var t in e)b.Defaults[t]=e[t]},b.restoreDefaults=function(){b.Defaults=O.extend({},S)};var M=null,_=null,D=!1,P={},H={},B={},j={},F={},I={},q={},R=[],U=[],z=this.Defaults.Scope,W=null,X=function(e,t,n){var r=e[t];return r==null&&(r=[],e[t]=r),r.push(n),r},V=function(e,t){b.Defaults.Container?O.CurrentLibrary.appendElement(e,b.Defaults.Container):t?O.CurrentLibrary.appendElement(e,t):jsPlumbAdapter.appendToRoot(e)},$=1,J=function(){return""+$++},K=function(e){return e._nodes?e._nodes:e},Q=function(e,t,n){if(!jsPlumbAdapter.headless&&!Kt){var r=l(e,"id"),i=b.dragManager.getElementsForDraggable(r);n==null&&(n=x()),b.anchorManager.redraw(r,t,n);if(i)for(var s in i)b.anchorManager.redraw(i[s].id,t,n,i[s].offset)}},G=function(e,t){var n=null;if(o(e)){n=[];for(var r=0;r<e.length;r++){var i=v(e[r]),s=l(i,"id");n.push(t(i,s))}}else{var i=v(e),s=l(i,"id");n=t(i,s)}return n},Y=function(e){return B[e]},Z=function(e,t,n){if(!jsPlumbAdapter.headless){var r=t==null?!1:t,i=O.CurrentLibrary;if(r&&i.isDragSupported(e)&&!i.isAlreadyDraggable(e)){var s=n||b.Defaults.DragOptions||O.Defaults.DragOptions;s=O.extend({},s);var o=i.dragEvents.drag,u=i.dragEvents.stop,a=i.dragEvents.start;s[a]=gt(s[a],function(){b.setHoverSuspended(!0)}),s[o]=gt(s[o],function(){var t=i.getUIPosition(arguments,b.getZoom());Q(e,t),h(e,"jsPlumb_dragged")}),s[u]=gt(s[u],function(){var t=i.getUIPosition(arguments,b.getZoom());Q(e,t),d(e,"jsPlumb_dragged"),b.setHoverSuspended(!1)});var f=mt(e);q[f]=!0;var r=q[f];s.disabled=r==null?!1:!r,i.initDraggable(e,s,!1),b.dragManager.register(e)}}},et=function(e,t){var n=O.extend({sourceIsNew:!0,targetIsNew:!0},e);t&&O.extend(n,t),n.source&&n.source.endpoint&&(n.sourceEndpoint=n.source),n.source&&n.target.endpoint&&(n.targetEndpoint=n.target),e.uuids&&(n.sourceEndpoint=Y(e.uuids[0]),n.targetEndpoint=Y(e.uuids[1]));if(n.sourceEndpoint&&n.sourceEndpoint.isFull()){y(b,"could not add connection; source endpoint is full");return}if(n.targetEndpoint&&n.targetEndpoint.isFull()){y(b,"could not add connection; target endpoint is full");return}n.sourceEndpoint&&(n.sourceIsNew=!1),n.targetEndpoint&&(n.targetIsNew=!1),!n.type&&n.sourceEndpoint&&(n.type=n.sourceEndpoint.connectionType);if(n.sourceEndpoint&&n.sourceEndpoint.connectorOverlays){n.overlays=n.overlays||[];for(var r=0;r<n.sourceEndpoint.connectorOverlays.length;r++)n.overlays.push(n.sourceEndpoint.connectorOverlays[r])}n.tooltip=e.tooltip,!n.tooltip&&n.sourceEndpoint&&n.sourceEndpoint.connectorTooltip&&(n.tooltip=n.sourceEndpoint.connectorTooltip);if(n.target&&!n.target.endpoint&&!n.targetEndpoint&&!n.newConnection){var i=mt(n.target),s=Pt[i],o=Ht[i];if(s){if(!Xt[i])return;var u=o!=null?o:b.addEndpoint(n.target,s);Bt[i]&&(Ht[i]=u),n.targetEndpoint=u,u._makeTargetCreator=!0,n.targetIsNew=!0}}if(n.source&&!n.source.endpoint&&!n.sourceEndpoint&&!n.newConnection){var i=mt(n.source),s=It[i],o=qt[i];if(s){if(!Ut[i])return;var u=o!=null?o:b.addEndpoint(n.source,s);Rt[i]&&(qt[i]=u),n.sourceEndpoint=u,n.sourceIsNew=!0}}return n},tt=function(e){var t=b.Defaults.ConnectionType||b.getDefaultConnectionType(),n=b.Defaults.EndpointType||bn,r=O.CurrentLibrary.getParent;e.container?e.parent=e.container:e.sourceEndpoint?e.parent=e.sourceEndpoint.parent:e.source.constructor==n?e.parent=e.source.parent:e.parent=r(e.source),e._jsPlumb=b;var i=new t(e);return i.id="con_"+J(),rt("click","click",i),rt("dblclick","dblclick",i),rt("contextmenu","contextmenu",i),i},nt=function(e,t,n){t=t||{},e.suspendedEndpoint||X(P,e.scope,e);if(!t.doNotFireConnectionEvent&&t.fireEvent!==!1){var r={connection:e,source:e.source,target:e.target,sourceId:e.sourceId,targetId:e.targetId,sourceEndpoint:e.endpoints[0],targetEndpoint:e.endpoints[1]};b.fire("jsPlumbConnection",r,n),b.fire("connection",r,n)}b.anchorManager.newConnection(e),Q(e.source)},rt=function(e,t,n){n.bind(e,function(e,r){b.fire(t,n,r)})},it=function(e){if(e.container)return e.container;var t=O.CurrentLibrary.getTagName(e.source),n=O.CurrentLibrary.getParent(e.source);return t&&t.toLowerCase()==="td"?O.CurrentLibrary.getParent(n):n},st=function(e){var t=b.Defaults.EndpointType||bn;e.parent=it(e),e._jsPlumb=b;var n=new t(e);return n.id="ep_"+J(),rt("click","endpointClick",n),rt("dblclick","endpointDblClick",n),rt("contextmenu","contextmenu",n),jsPlumbAdapter.headless||b.dragManager.endpointAdded(e.source),n},ot=function(e,t,n){var r=H[e];if(r&&r.length)for(var i=0;i<r.length;i++){for(var s=0;s<r[i].connections.length;s++){var o=t(r[i].connections[s]);if(o)return}n&&n(r[i])}},ut=function(e){for(var t in H)ot(t,e)},at=function(e,t){e!=null&&e.parentNode!=null&&e.parentNode.removeChild(e)},ft=function(e,t){for(var n=0;n<e.length;n++)at(e[n],t)},lt=function(e,t){return G(e,function(e,n){q[n]=t,O.CurrentLibrary.isDragSupported(e)&&O.CurrentLibrary.setDraggable(e,t)})},ct=function(e,t,n){t=t==="block";var r=null;n&&(t?r=function(e){e.setVisible(!0,!0,!0)}:r=function(e){e.setVisible(!1,!0,!0)});var i=l(e,"id");ot(i,function(e){if(t&&n){var r=e.sourceId===i?1:0;e.endpoints[r].isVisible()&&e.setVisible(!0)}else e.setVisible(t)},r)},ht=function(e){return G(e,function(e,t){var n=q[t]==null?!1:q[t];return n=!n,q[t]=n,O.CurrentLibrary.setDraggable(e,n),n})},pt=function(e,t){var n=null;t&&(n=function(e){var t=e.isVisible();e.setVisible(!t)}),ot(e,function(e){var t=e.isVisible();e.setVisible(!t)},n)},dt=function(e){var t=e.timestamp,n=e.recalc,r=e.offset,i=e.elId;Kt&&!t&&(t=Qt);if(!n&&t&&t===F[i])return j[i];if(n||!r){var s=v(i);s!=null&&(U[i]=g(s),j[i]=m(s,b),F[i]=t)}else{j[i]=r;if(U[i]==null){var s=v(i);s!=null&&(U[i]=g(s))}}return j[i]&&!j[i].right&&(j[i].right=j[i].left+U[i][0],j[i].bottom=j[i].top+U[i][1],j[i].width=U[i][0],j[i].height=U[i][1],j[i].centerx=j[i].left+j[i].width/2,j[i].centery=j[i].top+j[i].height/2),j[i]},vt=function(e){var t=j[e];return t||(t=dt({elId:e})),{o:t,s:U[e]}},mt=function(e,t,n){var r=v(e),i=l(r,"id");if(!i||i=="undefined"){if(arguments.length==2&&arguments[1]!=undefined)i=t;else if(arguments.length==1||arguments.length==3&&!arguments[2])i="jsPlumb_"+w+"_"+J();n||c(r,"id",i)}return i},gt=function(e,t,n){return e=e||function(){},t=t||function(){},function(){var r=null;try{r=t.apply(this,arguments)}catch(i){y(b,"jsPlumb function failed : "+i)}if(n==null||r!==n)try{e.apply(this,arguments)}catch(i){y(b,"wrapped function failed : "+i)}return r}};this.connectorClass="_jsPlumb_connector",this.endpointClass="_jsPlumb_endpoint",this.overlayClass="_jsPlumb_overlay",this.Anchors={},this.Connectors={canvas:{},svg:{},vml:{}},this.Endpoints={canvas:{},svg:{},vml:{}},this.Overlays={canvas:{},svg:{},vml:{}},this.addClass=function(e,t){return O.CurrentLibrary.addClass(e,t)},this.removeClass=function(e,t){return O.CurrentLibrary.removeClass(e,t)},this.hasClass=function(e,t){return O.CurrentLibrary.hasClass(e,t)},this.addEndpoint=function(e,t,n){n=n||{};var r=O.extend({},n);O.extend(r,t),r.endpoint=r.endpoint||b.Defaults.Endpoint||O.Defaults.Endpoint,r.paintStyle=r.paintStyle||b.Defaults.EndpointStyle||O.Defaults.EndpointStyle,e=K(e);var i=[],s=e.length&&e.constructor!=String?e:[e];for(var o=0;o<s.length;o++){var u=v(s[o]),a=mt(u);r.source=u,dt({elId:a,timestamp:Qt});var f=st(r);r.parentAnchor&&(f.parentAnchor=r.parentAnchor),X(H,a,f);var l=j[a],c=U[a],h=f.anchor.compute({xy:[l.left,l.top],wh:c,element:f,timestamp:Qt}),p={anchorLoc:h,timestamp:Qt};Kt&&(p.recalc=!1),f.paint(p),i.push(f)}return i.length==1?i[0]:i},this.addEndpoints=function(e,t,n){var r=[];for(var i=0;i<t.length;i++){var s=b.addEndpoint(e,t[i],n);o(s)?Array.prototype.push.apply(r,s):r.push(s)}return r},this.animate=function(e,t,n){var r=v(e),i=l(e,"id");n=n||{};var s=O.CurrentLibrary.dragEvents.step,o=O.CurrentLibrary.dragEvents.complete;n[s]=gt(n[s],function(){b.repaint(i)}),n[o]=gt(n[o],function(){b.repaint(i)}),O.CurrentLibrary.animate(r,t,n)},this.checkCondition=function(e,t){var n=b.getListener(e),r=!0;if(n&&n.length>0)try{for(var i=0;i<n.length;i++)r=r&&n[i](t)}catch(s){y(b,"cannot check condition ["+e+"]"+s)}return r},this.connect=function(e,t){var n=et(e,t),r;return n&&(n.deleteEndpointsOnDetach==null&&(n.deleteEndpointsOnDetach=!0),r=tt(n),nt(r,n)),r},this.deleteEndpoint=function(e){var t=typeof e=="string"?B[e]:e;if(t){var n=t.getUuid();n&&(B[n]=null),t.detachAll(),t.endpoint.cleanup&&t.endpoint.cleanup(),ft(t.endpoint.getDisplayElements()),b.anchorManager.deleteEndpoint(t);for(var r in H){var i=H[r];if(i){var s=[];for(var o=0;o<i.length;o++)i[o]!=t&&s.push(i[o]);H[r]=s}}jsPlumbAdapter.headless||b.dragManager.endpointDeleted(t)}},this.deleteEveryEndpoint=function(){b.setSuspendDrawing(!0);for(var e in H){var t=H[e];if(t&&t.length)for(var n=0;n<t.length;n++)b.deleteEndpoint(t[n])}H={},B={},b.setSuspendDrawing(!1,!0)};var yt=function(e,t,n){var r=b.Defaults.ConnectionType||b.getDefaultConnectionType(),i=e.constructor==r,s=i?{connection:e,source:e.source,target:e.target,sourceId:e.sourceId,targetId:e.targetId,sourceEndpoint:e.endpoints[0],targetEndpoint:e.endpoints[1]}:e;t&&(b.fire("jsPlumbConnectionDetached",s,n),b.fire("connectionDetached",s,n)),b.anchorManager.connectionDetached(s)},bt=function(e){b.fire("connectionDrag",e)},wt=function(e){b.fire("connectionDragStop",e)};this.detach=function(){if(arguments.length==0)return;var e=b.Defaults.ConnectionType||b.getDefaultConnectionType(),t=arguments[0].constructor==e,n=arguments.length==2?t?arguments[1]||{}:arguments[0]:arguments[0],r=n.fireEvent!==!1,i=n.forceDetach,s=t?arguments[0]:n.connection;if(s)(i||s.isDetachAllowed(s)&&s.endpoints[0].isDetachAllowed(s)&&s.endpoints[1].isDetachAllowed(s))&&(i||b.checkCondition("beforeDetach",s))&&s.endpoints[0].detach(s,!1,!0,r);else{var o=O.extend({},n);if(o.uuids)Y(o.uuids[0]).detachFrom(Y(o.uuids[1]),r);else if(o.sourceEndpoint&&o.targetEndpoint)o.sourceEndpoint.detachFrom(o.targetEndpoint);else{var u=mt(o.source),a=mt(o.target);ot(u,function(e){(e.sourceId==u&&e.targetId==a||e.targetId==u&&e.sourceId==a)&&b.checkCondition("beforeDetach",e)&&e.endpoints[0].detach(e,!1,!0,r)})}}},this.detachAllConnections=function(e,t){t=t||{},e=v(e);var n=l(e,"id"),r=H[n];if(r&&r.length)for(var i=0;i<r.length;i++)r[i].detachAll(t.fireEvent)},this.detachEveryConnection=function(e){e=e||{};for(var t in H){var n=H[t];if(n&&n.length)for(var r=0;r<n.length;r++)n[r].detachAll(e.fireEvent)}P={}},this.draggable=function(e,t){if(typeof e=="object"&&e.length)for(var n=0;n<e.length;n++){var r=v(e[n]);r&&Z(r,!0,t)}else if(e._nodes)for(var n=0;n<e._nodes.length;n++){var r=v(e._nodes[n]);r&&Z(r,!0,t)}else{var r=v(e);r&&Z(r,!0,t)}},this.extend=function(e,t){return O.CurrentLibrary.extend(e,t)},this.getDefaultEndpointType=function(){return bn},this.getDefaultConnectionType=function(){return vn};var Et=function(e,t,n,r){for(var i=0;i<e.length;i++)e[i][t].apply(e[i],n);return r(e)},St=function(e,t,n){var r=[];for(var i=0;i<e.length;i++)r.push([e[i][t].apply(e[i],n),e[i]]);return r},xt=function(e,t,n){return function(){return Et(e,t,arguments,n)}},Tt=function(e,t){return function(){return St(e,t,arguments)}},Nt=function(e,t){var n=[];if(e)if(typeof e=="string"){if(e==="*")return e;n.push(e)}else if(t)n=e;else for(var r=0;r<e.length;r++)n.push(mt(v(e[r])));return n},Ct=function(e,n,r){return e==="*"?!0:e.length>0?t(e,n)!=-1:!r};this.getConnections=function(e,t){e?e.constructor==String&&(e={scope:e}):e={};var n=e.scope||b.getDefaultScope(),r=Nt(n,!0),i=Nt(e.source),s=Nt(e.target),o=!t&&r.length>1?{}:[],u=function(e,n){if(!t&&r.length>1){var i=o[e];i==null&&(i=[],o[e]=i),i.push(n)}else o.push(n)};for(var a in P)if(Ct(r,a))for(var f=0;f<P[a].length;f++){var l=P[a][f];Ct(i,l.sourceId)&&Ct(s,l.targetId)&&u(a,l)}return o};var kt=function(e,t){return function(n){for(var r=0;r<e.length;r++)n(e[r]);return t(e)}},Lt=function(e){return function(t){return e[t]}},At=function(e,t){return{setHover:xt(e,"setHover",t),removeAllOverlays:xt(e,"removeAllOverlays",t),setLabel:xt(e,"setLabel",t),addOverlay:xt(e,"addOverlay",t),removeOverlay:xt(e,"removeOverlay",t),removeOverlays:xt(e,"removeOverlays",t),showOverlay:xt(e,"showOverlay",t),hideOverlay:xt(e,"hideOverlay",t),showOverlays:xt(e,"showOverlays",t),hideOverlays:xt(e,"hideOverlays",t),setPaintStyle:xt(e,"setPaintStyle",t),setHoverPaintStyle:xt(e,"setHoverPaintStyle",t),setParameter:xt(e,"setParameter",t),setParameters:xt(e,"setParameters",t),setVisible:xt(e,"setVisible",t),setZIndex:xt(e,"setZIndex",t),repaint:xt(e,"repaint",t),addType:xt(e,"addType",t),toggleType:xt(e,"toggleType",t),removeType:xt(e,"removeType",t),getLabel:Tt(e,"getLabel"),getOverlay:Tt(e,"getOverlay"),isHover:Tt(e,"isHover"),getParameter:Tt(e,"getParameter"),getParameters:Tt(e,"getParameters"),getPaintStyle:Tt(e,"getPaintStyle"),getHoverPaintStyle:Tt(e,"getHoverPaintStyle"),isVisible:Tt(e,"isVisible"),getZIndex:Tt(e,"getZIndex"),hasType:Tt(e,"hasType"),getType:Tt(e,"getType"),length:e.length,each:kt(e,t),get:Lt(e)}},Ot=function(e){var t=At(e,Ot);return O.CurrentLibrary.extend(t,{setDetachable:xt(e,"setDetachable",Ot),setReattach:xt(e,"setReattach",Ot),setConnector:xt(e,"setConnector",Ot),detach:function(){for(var t=0;t<e.length;t++)b.detach(e[t])},isDetachable:Tt(e,"isDetachable"),isReattach:Tt(e,"isReattach")})},Mt=function(e){var t=At(e,Mt);return O.CurrentLibrary.extend(t,{setEnabled:xt(e,"setEnabled",Mt),isEnabled:Tt(e,"isEnabled"),detachAll:function(){for(var t=0;t<e.length;t++)e[t].detachAll()},"delete":function(){for(var t=0;t<e.length;t++)b.deleteEndpoint(e[t])}})};this.select=function(e){e=e||{},e.scope=e.scope||"*";var t=b.getConnections(e,!0);return Ot(t)},this.selectEndpoints=function(e){e=e||{},e.scope=e.scope||"*";var t=!e.element&&!e.source&&!e.target,n=t?"*":Nt(e.element),r=t?"*":Nt(e.source),i=t?"*":Nt(e.target),s=Nt(e.scope,!0),o=[];for(var u in H){var a=Ct(n,u,!0),f=Ct(r,u,!0),l=r!="*",c=Ct(i,u,!0),h=i!="*";if(a||f||c)e:for(var p=0;p<H[u].length;p++){var d=H[u][p];if(Ct(s,d.scope,!0)){var v=l&&r.length>0&&!d.isSource,m=h&&i.length>0&&!d.isTarget;if(v||m)continue e;o.push(d)}}}return Mt(o)},this.getAllConnections=function(){return P},this.getDefaultScope=function(){return z},this.getEndpoint=Y,this.getEndpoints=function(e){return H[mt(e)]},this.getId=mt,this.getOffset=function(e){var t=j[e];return dt({elId:e})},this.getSelector=function(e){return O.CurrentLibrary.getSelector(e)},this.getSize=function(e){var t=U[e];return t||dt({elId:e}),U[e]},this.appendElement=V;var _t=!1;this.isHoverSuspended=function(){return _t},this.setHoverSuspended=function(e){_t=e};var Dt=function(e){return function(){return jsPlumbAdapter.isRenderModeAvailable(e)}};this.isCanvasAvailable=Dt("canvas"),this.isSVGAvailable=Dt("svg"),this.isVMLAvailable=Dt("vml"),this.hide=function(e,t){ct(e,"none",t)},this.idstamp=J,this.init=function(){if(!D){b.setRenderMode(b.Defaults.RenderMode);var e=function(e){O.CurrentLibrary.bind(document,e,function(t){if(!b.currentlyDragging&&W==O.CANVAS){for(var n in P){var r=P[n];for(var i=0;i<r.length;i++){var s=r[i].connector[e](t);if(s)return}}for(var o in H){var u=H[o];for(var i=0;i<u.length;i++)if(u[i].endpoint[e](t))return}}})};e("click"),e("dblclick"),e("mousemove"),e("mousedown"),e("mouseup"),e("contextmenu"),D=!0,b.fire("ready")}},this.log=M,this.jsPlumbUIComponent=T,this.makeAnchor=function(){if(arguments.length==0)return null;var e=arguments[0],t=arguments[1],n=arguments[2],r=null;if(e.compute&&e.getOrientation)return e;if(typeof e=="string")r=O.Anchors[arguments[0]]({elementId:t,jsPlumbInstance:b});else if(o(e))if(o(e[0])||u(e[0]))if(e.length==2&&u(e[0])&&a(e[1])){var i=O.extend({elementId:t,jsPlumbInstance:b},e[1]);r=O.Anchors[e[0]](i)}else r=new en(e,null,t);else{var s={x:e[0],y:e[1],orientation:e.length>=4?[e[2],e[3]]:[0,0],offsets:e.length==6?[e[4],e[5]]:[0,0],elementId:t};r=new Yt(s),r.clone=function(){return new Yt(s)}}return r.id||(r.id="anchor_"+J()),r},this.makeAnchors=function(e,t,n){var r=[];for(var i=0;i<e.length;i++)typeof e[i]=="string"?r.push(O.Anchors[e[i]]({elementId:t,jsPlumbInstance:n})):o(e[i])&&r.push(b.makeAnchor(e[i],t,n));return r},this.makeDynamicAnchor=function(e,t){return new en(e,t)};var Pt={},Ht={},Bt={},jt={},Ft=function(e,t){e.paintStyle=e.paintStyle||b.Defaults.EndpointStyles[t]||b.Defaults.EndpointStyle||O.Defaults.EndpointStyles[t]||O.Defaults.EndpointStyle,e.hoverPaintStyle=e.hoverPaintStyle||b.Defaults.EndpointHoverStyles[t]||b.Defaults.EndpointHoverStyle||O.Defaults.EndpointHoverStyles[t]||O.Defaults.EndpointHoverStyle,e.anchor=e.anchor||b.Defaults.Anchors[t]||b.Defaults.Anchor||O.Defaults.Anchors[t]||O.Defaults.Anchor,e.endpoint=e.endpoint||b.Defaults.Endpoints[t]||b.Defaults.Endpoint||O.Defaults.Endpoints[t]||O.Defaults.Endpoint};this.makeTarget=function(e,t,n){var r=O.extend({_jsPlumb:b},n);O.extend(r,t),Ft(r,1);var i=O.CurrentLibrary,s=r.scope||b.Defaults.Scope,o=r.deleteEndpointsOnDetach!==!1,u=r.maxConnections||-1,a=r.onMaxConnections;_doOne=function(e){var t=mt(e);Pt[t]=r,Bt[t]=r.uniqueEndpoint,jt[t]=u,Xt[t]=!0,proxyComponent=new T(r);var n=O.extend({},r.dropOptions||{}),f=function(){var n=O.CurrentLibrary.getDropEvent(arguments),s=b.select({target
:t}).length;b.currentlyDragging=!1;var u=v(i.getDragObject(arguments)),f=l(u,"dragId"),c=l(u,"originalScope"),h=I[f],p=h.endpoints[0],d=r.endpoint?O.extend({},r.endpoint):{};if(!Xt[t]||jt[t]>0&&s>=jt[t])return a&&a({element:e,connection:h},n),!1;p.anchor.locked=!1,c&&i.setDragScope(u,c);var y=proxyComponent.isDropAllowed(h.sourceId,mt(e),h.scope,h,null);h.endpointsToDeleteOnDetach&&(p===h.endpointsToDeleteOnDetach[0]?h.endpointsToDeleteOnDetach[0]=null:p===h.endpointsToDeleteOnDetach[1]&&(h.endpointsToDeleteOnDetach[1]=null)),h.suspendedEndpoint&&(h.targetId=h.suspendedEndpoint.elementId,h.target=i.getElementObject(h.suspendedEndpoint.elementId),h.endpoints[1]=h.suspendedEndpoint);if(y){p.detach(h,!1,!0,!1);var w=Ht[t]||b.addEndpoint(e,r);r.uniqueEndpoint&&(Ht[t]=w),w._makeTargetCreator=!0;if(w.anchor.positionFinder!=null){var E=i.getUIPosition(arguments,b.getZoom()),S=m(e,b),x=g(e),T=w.anchor.positionFinder(E,S,x,w.anchor.constructorParams);w.anchor.x=T[0],w.anchor.y=T[1]}var N=b.connect({source:p,target:w,scope:c,previousConnection:h,container:h.parent,deleteEndpointsOnDetach:o,doNotFireConnectionEvent:p.endpointWillMoveAfterConnection});h.endpoints[1]._makeTargetCreator&&h.endpoints[1].connections.length<2&&b.deleteEndpoint(h.endpoints[1]),o&&(N.endpointsToDeleteOnDetach=[p,w]),N.repaint()}else h.suspendedEndpoint&&(h.isReattach()?(h.setHover(!1),h.floatingAnchorIndex=null,h.suspendedEndpoint.addConnection(h),b.repaint(p.elementId)):p.detach(h,!1,!0,!0,n))},c=i.dragEvents.drop;n.scope=n.scope||s,n[c]=gt(n[c],f),i.initDroppable(e,n,!0)},e=K(e);var f=e.length&&e.constructor!=String?e:[e];for(var c=0;c<f.length;c++)_doOne(v(f[c]));return b},this.unmakeTarget=function(e,t){e=O.CurrentLibrary.getElementObject(e);var n=mt(e);return t||(delete Pt[n],delete Bt[n],delete jt[n],delete Xt[n]),b},this.makeTargets=function(e,t,n){for(var r=0;r<e.length;r++)b.makeTarget(e[r],t,n)};var It={},qt={},Rt={},Ut={},zt={},Wt={},Xt={};this.makeSource=function(e,t,r){var i=O.extend({},r);O.extend(i,t),Ft(i,0);var s=O.CurrentLibrary,o=i.maxConnections||-1,u=i.onMaxConnections,a=function(e){var r=mt(e),a=i.parent,f=a!=null?b.getId(s.getElementObject(a)):r;It[f]=i,Rt[f]=i.uniqueEndpoint,Ut[f]=!0;var l=s.dragEvents.stop,c=s.dragEvents.drag,h=O.extend({},i.dragOptions||{}),p=h.drag,d=h.stop,v=null,m=!1;Wt[f]=o,h.scope=h.scope||i.scope,h[c]=gt(h[c],function(){p&&p.apply(this,arguments),m=!1}),h[l]=gt(h[l],function(){d&&d.apply(this,arguments),b.currentlyDragging=!1;if(v.connections.length==0)b.deleteEndpoint(v);else{s.unbind(v.canvas,"mousedown");var e=i.anchor||b.Defaults.Anchor,t=v.anchor,o=v.connections[0];v.anchor=b.makeAnchor(e,r,b);if(i.parent){var u=s.getElementObject(i.parent);if(u){var a=v.elementId,f=i.container||b.Defaults.Container||O.Defaults.Container;v.setElement(u,f),v.endpointWillMoveAfterConnection=!1,b.anchorManager.rehomeEndpoint(a,u),o.previousConnection=null,n(P[o.scope],function(e){return e.id===o.id}),b.anchorManager.connectionDetached({sourceId:o.sourceId,targetId:o.targetId,connection:o}),nt(o)}}v.repaint(),b.repaint(v.elementId),b.repaint(o.targetId)}});var g=function(n){if(!Ut[f])return;var a=b.select({source:f}).length;if(Wt[f]>=0&&a>=Wt[f])return u&&u({element:e,maxConnections:o},n),!1;if(t.filter){var l=t.filter(s.getOriginalEvent(n),e);if(l===!1)return}var c=dt({elId:r}),p=((n.pageX||n.page.x)-c.left)/c.width,d=((n.pageY||n.page.y)-c.top)/c.height,g=p,y=d;if(i.parent){var w=s.getElementObject(i.parent),E=mt(w);c=dt({elId:E}),g=((n.pageX||n.page.x)-c.left)/c.width,y=((n.pageY||n.page.y)-c.top)/c.height}var S={};O.extend(S,i),S.isSource=!0,S.anchor=[p,d,0,0],S.parentAnchor=[g,y,0,0],S.dragOptions=h;if(i.parent){var x=S.container||b.Defaults.Container||O.Defaults.Container;x?S.container=x:S.container=O.CurrentLibrary.getParent(i.parent)}v=b.addEndpoint(r,S),m=!0,v.endpointWillMoveAfterConnection=i.parent!=null,v.endpointWillMoveTo=i.parent?s.getElementObject(i.parent):null;var T=function(){m&&b.deleteEndpoint(v)};b.registerListener(v.canvas,"mouseup",T),b.registerListener(e,"mouseup",T),s.trigger(v.canvas,"mousedown",n)};b.registerListener(e,"mousedown",g),zt[r]=g};e=K(e);var f=e.length&&e.constructor!=String?e:[e];for(var l=0;l<f.length;l++)a(v(f[l]));return b},this.unmakeSource=function(e,t){e=O.CurrentLibrary.getElementObject(e);var n=mt(e),r=zt[n];return r&&b.unregisterListener(_el,"mousedown",r),t||(delete It[n],delete Rt[n],delete Ut[n],delete zt[n],delete Wt[n]),b},this.unmakeEverySource=function(){for(var e in Ut)b.unmakeSource(e,!0);It={},Rt={},Ut={},zt={}},this.unmakeEveryTarget=function(){for(var e in Xt)b.unmakeTarget(e,!0);return Pt={},Bt={},jt={},Xt={},b},this.makeSources=function(e,t,n){for(var r=0;r<e.length;r++)b.makeSource(e[r],t,n);return b};var Vt=function(e,t,n,r){var i=e=="source"?Ut:Xt;if(u(t))i[t]=r?!i[t]:n;else if(t.length){t=K(t);for(var s=0;s<t.length;s++){var o=_el=O.CurrentLibrary.getElementObject(t[s]),o=mt(_el);i[o]=r?!i[o]:n}}return b};this.setSourceEnabled=function(e,t){return Vt("source",e,t)},this.toggleSourceEnabled=function(e){return Vt("source",e,null,!0),b.isSourceEnabled(e)},this.isSource=function(e){return e=O.CurrentLibrary.getElementObject(e),Ut[mt(e)]!=null},this.isSourceEnabled=function(e){return e=O.CurrentLibrary.getElementObject(e),Ut[mt(e)]===!0},this.setTargetEnabled=function(e,t){return Vt("target",e,t)},this.toggleTargetEnabled=function(e){return Vt("target",e,null,!0)},this.isTarget=function(e){return e=O.CurrentLibrary.getElementObject(e),Xt[mt(e)]!=null},this.isTargetEnabled=function(e){return e=O.CurrentLibrary.getElementObject(e),Xt[mt(e)]===!0},this.ready=function(e){b.bind("ready",e)},this.repaint=function(e,t,n){if(typeof e=="object")for(var r=0;r<e.length;r++)Q(v(e[r]),t,n);else Q(v(e),t,n);return b},this.repaintEverything=function(){for(var e in H)Q(v(e));return b},this.removeAllEndpoints=function(e){var t=l(e,"id"),n=H[t];if(n)for(var r=0;r<n.length;r++)b.deleteEndpoint(n[r]);return H[t]=[],b};var $t={},Jt=function(){for(var e in $t)for(var t=0;t<$t[e].length;t++){var n=$t[e][t];O.CurrentLibrary.unbind(n.el,n.event,n.listener)}$t={}};this.registerListener=function(e,t,n){O.CurrentLibrary.bind(e,t,n),X($t,t,{el:e,event:t,listener:n})},this.unregisterListener=function(e,t,r){O.CurrentLibrary.unbind(e,t,r),n($t,function(e){return e.type==t&&e.listener==r})},this.reset=function(){b.deleteEveryEndpoint(),b.unbind(),Pt={},Ht={},Bt={},jt={},It={},qt={},Rt={},Wt={},Jt(),b.anchorManager.reset(),jsPlumbAdapter.headless||b.dragManager.reset()},this.setDefaultScope=function(e){return z=e,b},this.setDraggable=lt,this.setId=function(e,t,n){var r=e.constructor==String?e:b.getId(e),i=b.getConnections({source:r,scope:"*"},!0),s=b.getConnections({target:r,scope:"*"},!0);t=""+t,n||(e=O.CurrentLibrary.getElementObject(r),O.CurrentLibrary.setAttribute(e,"id",t)),e=O.CurrentLibrary.getElementObject(t),H[t]=H[r]||[];for(var o=0;o<H[t].length;o++)H[t][o].elementId=t,H[t][o].element=e,H[t][o].anchor.elementId=t;delete H[r],b.anchorManager.changeId(r,t);var u=function(n,r,i){for(var s=0;s<n.length;s++)n[s].endpoints[r].elementId=t,n[s].endpoints[r].element=e,n[s][i+"Id"]=t,n[s][i]=e};u(i,0,"source"),u(s,1,"target")},this.setIdChanged=function(e,t){b.setId(e,t,!0)},this.setDebugLog=function(e){M=e};var Kt=!1,Qt=null;this.setSuspendDrawing=function(e,t){Kt=e,e?Qt=(new Date).getTime():Qt=null,t&&b.repaintEverything()},this.isSuspendDrawing=function(){return Kt},this.CANVAS="canvas",this.SVG="svg",this.VML="vml",this.setRenderMode=function(e){return W=jsPlumbAdapter.setRenderMode(e),W},this.getRenderMode=function(){return W},this.show=function(e,t){return ct(e,"block",t),b},this.sizeCanvas=function(e,t,n,r,i){return e&&(e.style.height=i+"px",e.height=i,e.style.width=r+"px",e.width=r,e.style.left=t+"px",e.style.top=n+"px"),b},this.getTestHarness=function(){return{endpointsByElement:H,endpointCount:function(e){var t=H[e];return t?t.length:0},connectionCount:function(e){e=e||z;var t=P[e];return t?t.length:0},getId:mt,makeAnchor:self.makeAnchor,makeDynamicAnchor:self.makeDynamicAnchor}},this.toggle=pt,this.toggleVisible=pt,this.toggleDraggable=ht,this.wrap=gt,this.addListener=this.bind;var Gt=function(e,t){var n=null,r=e;t.tagName.toLowerCase()==="svg"&&t.parentNode?n=t.parentNode:t.offsetParent&&(n=t.offsetParent);if(n!=null){var i=n.tagName.toLowerCase()==="body"?{left:0,top:0}:m(n,b),s=n.tagName.toLowerCase()==="body"?{left:0,top:0}:{left:n.scrollLeft,top:n.scrollTop};r[0]=e[0]-i.left+s.left,r[1]=e[1]-i.top+s.top}return r},Yt=function(e){var t=this;this.x=e.x||0,this.y=e.y||0,this.elementId=e.elementId;var n=e.orientation||[0,0],r=null,i=null;this.offsets=e.offsets||[0,0],t.timestamp=null,this.compute=function(e){var n=e.xy,r=e.wh,s=e.element,o=e.timestamp;return o&&o===t.timestamp?i:(i=[n[0]+t.x*r[0]+t.offsets[0],n[1]+t.y*r[1]+t.offsets[1]],i=Gt(i,s.canvas),t.timestamp=o,i)},this.getOrientation=function(e){return n},this.equals=function(e){if(!e)return!1;var t=e.getOrientation(),n=this.getOrientation();return this.x==e.x&&this.y==e.y&&this.offsets[0]==e.offsets[0]&&this.offsets[1]==e.offsets[1]&&n[0]==t[0]&&n[1]==t[1]},this.getCurrentLocation=function(){return i}},Zt=function(e){var t=e.reference,n=e.referenceCanvas,r=g(v(n)),i=0,s=0,o=null,u=null;this.x=0,this.y=0,this.isFloating=!0,this.compute=function(e){var t=e.xy,n=e.element,i=[t[0]+r[0]/2,t[1]+r[1]/2];return i=Gt(i,n.canvas),u=i,i},this.getOrientation=function(e){if(o)return o;var n=t.getOrientation(e);return[Math.abs(n[0])*i*-1,Math.abs(n[1])*s*-1]},this.over=function(e){o=e.getOrientation()},this.out=function(){o=null},this.getCurrentLocation=function(){return u}},en=function(e,t,n){this.isSelective=!0,this.isDynamic=!0;var r=[],i=this,s=function(e){return e.constructor==Yt?e:b.makeAnchor(e,n,b)};for(var o=0;o<e.length;o++)r[o]=s(e[o]);this.addAnchor=function(e){r.push(s(e))},this.getAnchors=function(){return r},this.locked=!1;var u=r.length>0?r[0]:null,a=r.length>0?0:-1,i=this,f=function(e,t,n,r,i){var s=r[0]+e.x*i[0],o=r[1]+e.y*i[1];return Math.sqrt(Math.pow(t-s,2)+Math.pow(n-o,2))},l=t||function(e,t,n,r,i){var s=n[0]+r[0]/2,o=n[1]+r[1]/2,u=-1,a=Infinity;for(var l=0;l<i.length;l++){var c=f(i[l],s,o,e,t);c<a&&(u=l+0,a=c)}return i[u]};this.compute=function(e){var t=e.xy,n=e.wh,s=e.timestamp,o=e.txy,a=e.twh;return i.locked||o==null||a==null?u.compute(e):(e.timestamp=null,u=l(t,n,o,a,r),i.x=u.x,i.y=u.y,u.compute(e))},this.getCurrentLocation=function(){return u!=null?u.getCurrentLocation():null},this.getOrientation=function(e){return u!=null?u.getOrientation(e):[0,0]},this.over=function(e){u!=null&&u.over(e)},this.out=function(){u!=null&&u.out()}},tn={},nn={},rn={},sn={HORIZONTAL:"horizontal",VERTICAL:"vertical",DIAGONAL:"diagonal",IDENTITY:"identity"},on=function(e,t,n,r){if(e===t)return{orientation:sn.IDENTITY,a:["top","top"]};var i=Math.atan2(r.centery-n.centery,r.centerx-n.centerx),s=Math.atan2(n.centery-r.centery,n.centerx-r.centerx),o=n.left<=r.left&&n.right>=r.left||n.left<=r.right&&n.right>=r.right||n.left<=r.left&&n.right>=r.right||r.left<=n.left&&r.right>=n.right,u=n.top<=r.top&&n.bottom>=r.top||n.top<=r.bottom&&n.bottom>=r.bottom||n.top<=r.top&&n.bottom>=r.bottom||r.top<=n.top&&r.bottom>=n.bottom;if(!o&&!u){var a=null,f=!1,l=!1,c=null;return r.left>n.left&&r.top>n.top?a=["right","top"]:r.left>n.left&&n.top>r.top?a=["top","left"]:r.left<n.left&&r.top<n.top?a=["top","right"]:r.left<n.left&&r.top>n.top&&(a=["left","top"]),{orientation:sn.DIAGONAL,a:a,theta:i,theta2:s}}return o?{orientation:sn.HORIZONTAL,a:n.top<r.top?["bottom","top"]:["top","bottom"],theta:i,theta2:s}:{orientation:sn.VERTICAL,a:n.left<r.left?["right","left"]:["left","right"],theta:i,theta2:s}},un=function(e,t,n,r,i,s,o){var u=[],a=t[i?0:1]/(r.length+1);for(var f=0;f<r.length;f++){var l=(f+1)*a,c=s*t[i?1:0];o&&(l=t[i?0:1]-l);var h=i?l:c,p=n[0]+h,d=h/t[0],v=i?c:l,m=n[1]+v,g=v/t[1];u.push([p,m,d,g,r[f][1],r[f][2]])}return u},an=function(e,t){return e[0]>t[0]?1:-1},fn=function(e){return function(t,n){var r=!0;return e?t[0][0]<n[0][0]?r=!0:r=t[0][1]>n[0][1]:t[0][0]>n[0][0]?r=!0:r=t[0][1]>n[0][1],r===!1?-1:1}},ln=function(e,t){var n=e[0][0]<0?-Math.PI-e[0][0]:Math.PI-e[0][0],r=t[0][0]<0?-Math.PI-t[0][0]:Math.PI-t[0][0];return n>r?1:e[0][1]>t[0][1]?1:-1},cn={top:an,right:fn(!0),bottom:fn(!0),left:ln},hn=function(e,t){return e.sort(t)},pn=function(e,t){var n=U[e],r=j[e],i=function(t,n,r,i,s,o,u){if(i.length>0){var a=hn(i,cn[t]),f=t==="right"||t==="top",l=un(t,n,r,a,s,o,f),c=function(e,t){var n=Gt([t[0],t[1]],e.canvas);nn[e.id]=[n[0],n[1],t[2],t[3]],rn[e.id]=u};for(var h=0;h<l.length;h++){var p=l[h][4],d=p.endpoints[0].elementId===e,v=p.endpoints[1].elementId===e;d?c(p.endpoints[0],l[h]):v&&c(p.endpoints[1],l[h])}}};i("bottom",n,[r.left,r.top],t.bottom,!0,1,[0,1]),i("top",n,[r.left,r.top],t.top,!0,0,[0,-1]),i("left",n,[r.left,r.top],t.left,!1,0,[-1,0]),i("right",n,[r.left,r.top],t.right,!1,1,[1,0])},dn=function(){var t={},r={},s=this,o={};this.reset=function(){t={},r={},o={}},this.newConnection=function(e){var t=e.sourceId,n=e.targetId,i=e.endpoints,s=!0,o=function(e,o,u,a,f){t==n&&u.isContinuous&&(O.CurrentLibrary.removeElement(i[1].canvas),s=!1),X(r,a,[f,o,u.constructor==en])};o(0,i[0],i[0].anchor,n,e),s&&o(1,i[1],i[1].anchor,t,e)},this.connectionDetached=function(e){var t=e.connection||e,i=t.sourceId,u=t.targetId,a=t.endpoints,f=function(e,t,i,s,o){i.constructor!=Zt&&n(r[s],function(e){return e[0].id==o.id})};f(1,a[1],a[1].anchor,i,t),f(0,a[0],a[0].anchor,u,t);var l=t.sourceId,c=t.targetId,h=t.endpoints[0].id,p=t.endpoints[1].id,d=function(e,t){if(e){var r=function(e){return e[4]==t};n(e.top,r),n(e.left,r),n(e.bottom,r),n(e.right,r)}};d(o[l],h),d(o[c],p),s.redraw(l),s.redraw(c)},this.add=function(e,n){X(t,n,e)},this.changeId=function(e,n){r[n]=r[e],t[n]=t[e],delete r[e],delete t[e]},this.getConnectionsFor=function(e){return r[e]||[]},this.getEndpointsFor=function(e){return t[e]||[]},this.deleteEndpoint=function(e){n(t[e.elementId],function(t){return t.id==e.id})},this.clearFor=function(e){delete t[e],t[e]=[]};var u=function(t,n,r,s,o,u,a,f,l,c,h,p){var d=-1,v=-1,m=s.endpoints[a],g=m.id,y=[1,0][a],b=[[n,r],s,o,u,g],w=t[l],E=m._continuousAnchorEdge?t[m._continuousAnchorEdge]:null;if(E){var S=e(E,function(e){return e[4]==g});if(S!=-1){E.splice(S,1);for(var x=0;x<E.length;x++)i(h,E[x][1],function(e){return e.id==E[x][1].id}),i(p,E[x][1].endpoints[a],function(e){return e.id==E[x][1].endpoints[a].id})}}for(var x=0;x<w.length;x++)a==1&&w[x][3]===u&&v==-1&&(v=x),i(h,w[x][1],function(e){return e.id==w[x][1].id}),i(p,w[x][1].endpoints[a],function(e){return e.id==w[x][1].endpoints[a].id});if(d!=-1)w[d]=b;else{var T=f?v!=-1?v:0:w.length;w.splice(T,0,b)}m._continuousAnchorEdge=l};this.redraw=function(e,n,s,a){if(!Kt){var f=t[e]||[],l=r[e]||[],c=[],h=[],p=[];s=s||x(),a=a||{left:0,top:0},n&&(n={left:n.left+a.left,top:n.top+a.top}),dt({elId:e,offset:n,recalc:!1,timestamp:s});var d=j[e],v=U[e],m={};for(var g=0;g<l.length;g++){var y=l[g][0],b=y.sourceId,w=y.targetId,E=y.endpoints[0].anchor.isContinuous,S=y.endpoints[1].anchor.isContinuous;if(E||S){var T=b+"_"+w,N=w+"_"+b,C=m[T],k=y.sourceId==e?1:0;E&&!o[b]&&(o[b]={top:[],right:[],bottom:[],left:[]}),S&&!o[w]&&(o[w]={top:[],right:[],bottom:[],left:[]}),e!=w&&dt({elId:w,timestamp:s}),e!=b&&dt({elId:b,timestamp:s});var L=vt(w),A=vt(b);w==b&&(E||S)?u(o[b],-Math.PI/2,0,y,!1,w,0,!1,"top",b,c,h):(C||(C=on(b,w,A.o,L.o),m[T]=C),E&&u(o[b],C.theta,0,y,!1,w,0,!1,C.a[0],b,c,h),S&&u(o[w],C.theta2,-1,y,!0,b,1,!0,C.a[1],w,c,h)),E&&i(p,b,function(e){return e===b}),S&&i(p,w,function(e){return e===w}),i(c,y,function(e){return e.id==y.id}),(E&&k==0||S&&k==1)&&i(h,y.endpoints[k],function(e){return e.id==y.endpoints[k].id})}}for(var g=0;g<f.length;g++)f[g].connections.length==0&&f[g].anchor.isContinuous&&(o[e]||(o[e]={top:[],right:[],bottom:[],left:[]}),u(o[e],-Math.PI/2,0,{endpoints:[f[g],f[g]],paint:function(){}},!1,e,0,!1,"top",e,c,h),i(p,e,function(t){return t===e}));for(var g=0;g<p.length;g++)pn(p[g],o[p[g]]);for(var g=0;g<f.length;g++)f[g].paint({timestamp:s,offset:d,dimensions:v});for(var g=0;g<h.length;g++)h[g].paint({timestamp:s,offset:d,dimensions:v});for(var g=0;g<l.length;g++){var O=l[g][1];if(O.anchor.constructor==en){O.paint({elementWithPrecedence:e}),i(c,l[g][0],function(e){return e.id==l[g][0].id});for(var M=0;M<O.connections.length;M++)O.connections[M]!==l[g][0]&&i(c,O.connections[M],function(e){return e.id==O.connections[M].id})}else O.anchor.constructor==Yt&&i(c,l[g][0],function(e){return e.id==l[g][0].id})}var _=I[e];_&&_.paint({timestamp:s,recalc:!1,elId:e});for(var g=0;g<c.length;g++)c[g].paint({elId:e,timestamp:s,recalc:!1})}},this.rehomeEndpoint=function(e,n){var r=t[e]||[],i=b.getId(n);if(i!==e){for(var o=0;o<r.length;o++)s.add(r[o],i);r.splice(0,r.length)}}};b.anchorManager=new dn,b.continuousAnchorFactory={get:function(e){var t=tn[e.elementId];return t||(t={type:"Continuous",compute:function(e){return nn[e.element.id]||[0,0]},getCurrentLocation:function(e){return nn[e.id]||[0,0]},getOrientation:function(e){return rn[e.id]||[0,0]},isDynamic:!0,isContinuous:!0},tn[e.elementId]=t),t}},jsPlumbAdapter.headless||(b.dragManager=jsPlumbAdapter.getDragManager(b));var vn=function(e){var t=this,n=!0,r,i;t.idPrefix="_jsplumb_c_",t.defaultLabelLocation=.5,t.defaultOverlayKeys=["Overlays","ConnectionOverlays"],this.parent=e.parent,N.apply(this,arguments),this.isVisible=function(){return n},this.setVisible=function(e){n=e,t[e?"showOverlays":"hideOverlays"](),t.connector&&t.connector.canvas&&(t.connector.canvas.style.display=e?"block":"none"),t.repaint()},this.getTypeDescriptor=function(){return"connection"},this.getDefaultType=function(){return{parameters:{},scope:null,detachable:t._jsPlumb.Defaults.ConnectionsDetachable,rettach:t._jsPlumb.Defaults.ReattachConnections,paintStyle:t._jsPlumb.Defaults.PaintStyle||O.Defaults.PaintStyle,connector:t._jsPlumb.Defaults.Connector||O.Defaults.Connector,hoverPaintStyle:t._jsPlumb.Defaults.HoverPaintStyle||O.Defaults.HoverPaintStyle,overlays:t._jsPlumb.Defaults.ConnectorOverlays||O.Defaults.ConnectorOverlays}};var s=this.applyType;this.applyType=function(e){s(e),e.detachable!=null&&t.setDetachable(e.detachable),e.reattach!=null&&t.setReattach(e.reattach),e.scope&&(t.scope=e.scope),t.setConnector(e.connector)},i=t.setHover,t.setHover=function(e){var n=b.ConnectorZIndex||O.Defaults.ConnectorZIndex;n&&t.connector.setZIndex(n+(e?1:0)),t.connector.setHover.apply(t.connector,arguments),i.apply(t,arguments)},r=function(e){f==null&&t.setHover(e,!1)},this.setConnector=function(n,i){t.connector!=null&&ft(t.connector.getDisplayElements(),t.parent);var s={_jsPlumb:t._jsPlumb,parent:e.parent,cssClass:e.cssClass,container:e.container,tooltip:t.tooltip};u(n)?this.connector=new O.Connectors[W][n](s):o(n)&&(n.length==1?this.connector=new O.Connectors[W][n[0]](s):this.connector=new O.Connectors[W][n[0]](O.extend(n[1],s))),t.canvas=t.connector.canvas,C(t.connector,t,r);var a=b.ConnectorZIndex||O.Defaults.ConnectorZIndex;a&&t.connector.setZIndex(a),i||t.repaint()},this.source=v(e.source),this.target=v(e.target),e.sourceEndpoint&&(this.source=e.sourceEndpoint.endpointWillMoveTo||e.sourceEndpoint.getElement()),e.targetEndpoint&&(this.target=e.targetEndpoint.getElement()),t.previousConnection=e.previousConnection,this.sourceId=l(this.source,"id"),this.targetId=l(this.target,"id"),this.scope=e.scope,this.endpoints=[],this.endpointStyles=[];var a=function(e,t){return e?b.makeAnchor(e,t,b):null},c=function(e,n,r,i,s,o,u){var f;if(e)t.endpoints[n]=e,e.addConnection(t);else{r.endpoints||(r.endpoints=[null,null]);var l=r.endpoints[n]||r.endpoint||b.Defaults.Endpoints[n]||O.Defaults.Endpoints[n]||b.Defaults.Endpoint||O.Defaults.Endpoint;r.endpointStyles||(r.endpointStyles=[null,null]),r.endpointHoverStyles||(r.endpointHoverStyles=[null,null]);var c=r.endpointStyles[n]||r.endpointStyle||b.Defaults.EndpointStyles[n]||O.Defaults.EndpointStyles[n]||b.Defaults.EndpointStyle||O.Defaults.EndpointStyle;c.fillStyle==null&&o!=null&&(c.fillStyle=o.strokeStyle),c.outlineColor==null&&o!=null&&(c.outlineColor=o.outlineColor),c.outlineWidth==null&&o!=null&&(c.outlineWidth=o.outlineWidth);var h=r.endpointHoverStyles[n]||r.endpointHoverStyle||b.Defaults.EndpointHoverStyles[n]||O.Defaults.EndpointHoverStyles[n]||b.Defaults.EndpointHoverStyle||O.Defaults.EndpointHoverStyle;u!=null&&(h==null&&(h={}),h.fillStyle==null&&(h.fillStyle=u.strokeStyle));var p=r.anchors?r.anchors[n]:r.anchor?r.anchor:a(b.Defaults.Anchors[n],s)||a(O.Defaults.Anchors[n],s)||a(b.Defaults.Anchor,s)||a(O.Defaults.Anchor,s),d=r.uuids?r.uuids[n]:null;f=st({paintStyle:c,hoverPaintStyle:h,endpoint:l,connections:[t],uuid:d,anchor:p,source:i,scope:r.scope,container:r.container,reattach:r.reattach||b.Defaults.ReattachConnections,detachable:r.detachable||b.Defaults.ConnectionsDetachable}),t.endpoints[n]=f,r.drawEndpoints===!1&&f.setVisible(!1,!0,!0)}return f},h=c(e.sourceEndpoint,0,e,t.source,t.sourceId,e.paintStyle,e.hoverPaintStyle);h&&X(H,this.sourceId,h);var p=c(e.targetEndpoint,1,e,t.target,t.targetId,e.paintStyle,e.hoverPaintStyle);p&&X(H,this.targetId,p),this.scope||(this.scope=this.endpoints[0].scope),t.endpointsToDeleteOnDetach=[null,null],e.deleteEndpointsOnDetach&&(e.sourceIsNew&&(t.endpointsToDeleteOnDetach[0]=t.endpoints[0]),e.targetIsNew&&(t.endpointsToDeleteOnDetach[1]=t.endpoints[1])),t.setConnector(this.endpoints[0].connector||this.endpoints[1].connector||e.connector||b.Defaults.Connector||O.Defaults.Connector,!0),this.setPaintStyle(this.endpoints[0].connectorStyle||this.endpoints[1].connectorStyle||e.paintStyle||b.Defaults.PaintStyle||O.Defaults.PaintStyle,!0),this.setHoverPaintStyle(this.endpoints[0].connectorHoverStyle||this.endpoints[1].connectorHoverStyle||e.hoverPaintStyle||b.Defaults.HoverPaintStyle||O.Defaults.HoverPaintStyle,!0),this.paintStyleInUse=this.getPaintStyle(),dt({elId:this.sourceId,timestamp:Qt}),dt({elId:this.targetId,timestamp:Qt});var d=j[this.sourceId],m=U[this.sourceId],g=j[this.targetId],y=U[this.targetId],w=Qt||x(),E=this.endpoints[0].anchor.compute({xy:[d.left,d.top],wh:m,element:this.endpoints[0],elementId:this.endpoints[0].elementId,txy:[g.left,g.top],twh:y,tElement:this.endpoints[1],timestamp:w});this.endpoints[0].paint({anchorLoc:E,timestamp:w}),E=this.endpoints[1].anchor.compute({xy:[g.left,g.top],wh:y,element:this.endpoints[1],elementId:this.endpoints[1].elementId,txy:[d.left,d.top],twh:m,tElement:this.endpoints[0],timestamp:w}),this.endpoints[1].paint({anchorLoc:E,timestamp:w});var S=b.Defaults.ConnectionsDetachable;e.detachable===!1&&(S=!1),t.endpoints[0].connectionsDetachable===!1&&(S=!1),t.endpoints[1].connectionsDetachable===!1&&(S=!1),this.isDetachable=function(){return S===!0},this.setDetachable=function(e){S=e===!0};var T=e.reattach||t.endpoints[0].reattachConnections||t.endpoints[1].reattachConnections||b.Defaults.ReattachConnections;this.isReattach=function(){return T===!0},this.setReattach=function(e){T=e===!0};var k=e.cost||t.endpoints[0].getConnectionCost();t.getCost=function(){return k},t.setCost=function(e){k=e};var L=e.bidirectional!==!1;e.bidirectional==null&&(L=t.endpoints[0].areConnectionsBidirectional()),t.isBidirectional=function(){return L};var A=O.extend({},this.endpoints[0].getParameters());O.extend(A,this.endpoints[1].getParameters()),O.extend(A,t.getParameters()),t.setParameters(A),this.getAttachedElements=function(){return t.endpoints},this.moveParent=function(e){var n=O.CurrentLibrary,r=n.getParent(t.connector.canvas);t.connector.bgCanvas&&(n.removeElement(t.connector.bgCanvas,r),n.appendElement(t.connector.bgCanvas,e)),n.removeElement(t.connector.canvas,r),n.appendElement(t.connector.canvas,e);for(var i=0;i<t.overlays.length;i++)t.overlays[i].isAppendedAtTopLevel&&(n.removeElement(t.overlays[i].canvas,r),n.appendElement(t.overlays[i].canvas,e),t.overlays[i].reattachListeners&&t.overlays[i].reattachListeners(t.connector));t.connector.reattachListeners&&t.connector.reattachListeners()};var M=null;this.paint=function(e){if(n){e=e||{};var r=e.elId,i=e.ui,s=e.recalc,o=e.timestamp,u=!1,a=u?this.sourceId:this.targetId,f=u?this.targetId:this.sourceId,l=u?0:1,c=u?1:0;if(o==null||o!=M){var h=dt({elId:r,offset:i,recalc:s,timestamp:o}),p=dt({elId:a,timestamp:o}),d=this.endpoints[c],v=this.endpoints[l],m=d.anchor.getCurrentLocation(d),g=v.anchor.getCurrentLocation(v),y=0;for(var b=0;b<t.overlays.length;b++){var w=t.overlays[b];w.isVisible()&&(y=Math.max(y,w.computeMaxSize()))}var E=this.connector.compute(m,g,this.endpoints[c],this.endpoints[l],this.endpoints[c].anchor,this.endpoints[l].anchor,t.paintStyleInUse.lineWidth,y,h,p);t.connector.paint(E,t.paintStyleInUse);for(var b=0;b<t.overlays.length;b++){var w=t.overlays[b];w.isVisible&&(t.overlayPlacements[b]=w.draw(t.connector,t.paintStyleInUse,E,o))}}M=o}},this.repaint=function(e){e=e||{};var t=e.recalc!==!1;this.paint({elId:this.sourceId,recalc:t,timestamp:e.timestamp})};var _=e.type||t.endpoints[0].connectionType||t.endpoints[1].connectionType;_&&t.addType(_)},mn=function(e){var t=!1;return{drag:function(){if(t)return t=!1,!0;var n=O.CurrentLibrary.getUIPosition(arguments,b.getZoom()),r=e.element;r&&(O.CurrentLibrary.setOffset(r,n),Q(v(r),n))},stopDrag:function(){t=!0}}},gn=function(e,t,n,r,i){var s=new Zt({reference:t,referenceCanvas:r});return st({paintStyle:e,endpoint:n,anchor:s,source:i,scope:"__floating"})},yn=function(e,t){var n=document.createElement("div");n.style.position="absolute";var r=v(n);V(n,t);var i=mt(r);dt({elId:i}),e.id=i,e.element=r},bn=function(t){var r=this;r.idPrefix="_jsplumb_e_",r.defaultLabelLocation=[.5,.5],r.defaultOverlayKeys=["Overlays","EndpointOverlays"],this.parent=t.parent,N.apply(this,arguments),t=t||{},this.getTypeDescriptor=function(){return"endpoint"},this.getDefaultType=function(){return{parameters:{},scope:null,maxConnections:r._jsPlumb.Defaults.MaxConnections,paintStyle:r._jsPlumb.Defaults.EndpointStyle||O.Defaults.EndpointStyle,endpoint:r._jsPlumb.Defaults.Endpoint||O.Defaults.Endpoint,hoverPaintStyle:r._jsPlumb.Defaults.EndpointHoverStyle||O.Defaults.EndpointHoverStyle,overlays:r._jsPlumb.Defaults.EndpointOverlays||O.Defaults.EndpointOverlays,connectorStyle:t.connectorStyle,connectorHoverStyle:t.connectorHoverStyle,connectorClass:t.connectorClass,connectorHoverClass:t.connectorHoverClass,connectorOverlays:t.connectorOverlays,connector:t.connector,connectorTooltip:t.connectorTooltip}};var i=this.applyType;this.applyType=function(e){i(e),e.maxConnections!=null&&(L=e.maxConnections),e.scope&&(r.scope=e.scope),r.connectorStyle=e.connectorStyle,r.connectorHoverStyle=e.connectorHoverStyle,r.connectorOverlays=e.connectorOverlays,r.connector=e.connector,r.connectorTooltip=e.connectorTooltip,r.connectionType=e.connectionType,r.connectorClass=e.connectorClass,r.connectorHoverClass=e.connectorHoverClass};var s=!0,a=t.enabled!==!1;this.isVisible=function(){return s},this.setVisible=function(e,t,n){s=e,r.canvas&&(r.canvas.style.display=e?"block":"none"),r[e?"showOverlays":"hideOverlays"]();if(!t)for(var i=0;i<r.connections.length;i++){r.connections[i].setVisible(e);if(!n){var o=r===r.connections[i].endpoints[0]?1:0;r.connections[i].endpoints[o].connections.length==1&&r.connections[i].endpoints[o].setVisible(e,!0,!0)}}},this.isEnabled=function(){return a},this.setEnabled=function(e){a=e};var f=t.source,h=t.uuid,p=null,d=null;h&&(B[h]=r);var g=l(f,"id");this.elementId=g,this.element=f;var y=t.connectionCost;this.getConnectionCost=function(){return y},this.setConnectionCost=function(e){y=e};var w=t.connectionsBidirectional===!1?!1:!0;this.areConnectionsBidirectional=function(){return w},this.setConnectionsBidirectional=function(e){w=e},r.anchor=t.anchor?b.makeAnchor(t.anchor,g,b):t.anchors?b.makeAnchor(t.anchors,g,b):b.makeAnchor(b.Defaults.Anchor||"TopCenter",g,b),t._transient||b.anchorManager.add(r,g);var E=null,S=null;this.setEndpoint=function(e){var n={_jsPlumb:r._jsPlumb,parent:t.parent,container:t.container,tooltip:t.tooltip,connectorTooltip:t.connectorTooltip,endpoint:r};u(e)?E=new O.Endpoints[W][e](n):o(e)?(n=O.extend(e[1],n),E=new O.Endpoints[W][e[0]](n)):E=e.clone();var i=O.extend({},n);E.clone=function(){var e=new Object;return E.constructor.apply(e,[i]),e},r.endpoint=E,r.type=r.endpoint.type},this.setEndpoint(t.endpoint||b.Defaults.Endpoint||O.Defaults.Endpoint||"Dot"),S=E;var x=r.setHover;r.setHover=function(){r.endpoint.setHover.apply(r.endpoint,arguments),x.apply(r,arguments)};var T=function(e){r.connections.length>0?r.connections[0].setHover(e,!1):r.setHover(e)};C(r.endpoint,r,T),this.setPaintStyle(t.paintStyle||t.style||b.Defaults.EndpointStyle||O.Defaults.EndpointStyle,!0),this.setHoverPaintStyle(t.hoverPaintStyle||b.Defaults.EndpointHoverStyle||O.Defaults.EndpointHoverStyle,!0),this.paintStyleInUse=this.getPaintStyle();var k=this.getPaintStyle();this.connectorStyle=t.connectorStyle,this.connectorHoverStyle=t.connectorHoverStyle,this.connectorOverlays=t.connectorOverlays,this.connector=t.connector,this.connectorTooltip=t.connectorTooltip,this.connectorClass=t.connectorClass,this.connectorHoverClass=t.connectorHoverClass,this.isSource=t.isSource||!1,this.isTarget=t.isTarget||!1;var L=t.maxConnections||b.Defaults.MaxConnections;this.getAttachedElements=function(){return r.connections},this.canvas=this.endpoint.canvas,this.connections=t.connections||[],this.scope=t.scope||z,this.connectionType=t.connectionType,this.timestamp=null,r.reattachConnections=t.reattach||b.Defaults.ReattachConnections,r.connectionsDetachable=b.Defaults.ConnectionsDetachable;if(t.connectionsDetachable===!1||t.detachable===!1)r.connectionsDetachable=!1;var A=t.dragAllowedWhenFull||!0;t.onMaxConnections&&r.bind("maxConnections",t.onMaxConnections),this.computeAnchor=function(e){return r.anchor.compute(e)},this.addConnection=function(e){r.connections.push(e)},this.detach=function(t,i,s,o,u){var a=e(r.connections,function(e){return e.id==t.id}),f=!1;o=o!==!1;if(a>=0)if(s||t._forceDetach||t.isDetachable()||t.isDetachAllowed(t)){var l=t.endpoints[0]==r?t.endpoints[1]:t.endpoints[0];if(s||t._forceDetach||r.isDetachAllowed(t)){r.connections.splice(a,1);if(!i){l.detach(t,!0,s);if(t.endpointsToDeleteOnDetach)for(var c=0;c<t.endpointsToDeleteOnDetach.length;c++){var h=t.endpointsToDeleteOnDetach[c];h&&h.connections.length==0&&b.deleteEndpoint(h)}}ft(t.connector.getDisplayElements(),t.parent),n(P[t.scope],function(e){return e.id==t.id}),f=!0;var p=!i&&o;yt(t,p,u)}}return f},this.detachAll=function(e,t){while(r.connections.length>0)r.detach(r.connections[0],!1,!0,e,t)},this.detachFrom=function(e,t,n){var i=[];for(var s=0;s<r.connections.length;s++)(r.connections[s].endpoints[1]==e||r.connections[s].endpoints[0]==e)&&i.push(r.connections[s]);for(var s=0;s<i.length;s++)r.detach(i[s],!1,!0,t,n)&&i[s].setHover(!1,!1)},this.detachFromConnection=function(t){var n=e(r.connections,function(e){return e.id==t.id});n>=0&&r.connections.splice(n,1)},this.getElement=function(){return f},this.setElement=function(e,t){var i=mt(e);n(H[r.elementId],function(e){return e.id==r.id}),f=v(e),g=mt(f),r.elementId=g;var s=it({source:i,container:t}),o=$.getParent(r.canvas);$.removeElement(r.canvas,o),$.appendElement(r.canvas,s);for(var u=0;u<r.connections.length;u++)r.connections[u].moveParent(s),r.connections[u].sourceId=g,r.connections[u].source=f;X(H,i,r)},this.getUuid=function(){return h},this.makeInPlaceCopy=function(){var e=r.anchor.getCurrentLocation(r),t=r.anchor.getOrientation(r),n={compute:function(){return[e[0],e[1]]},getCurrentLocation:function(){return[e[0],e[1]]},getOrientation:function(){return t}};return st({anchor:n,source:f,paintStyle:this.getPaintStyle(),endpoint:E,_transient:!0,scope:r.scope})},this.isConnectedTo=function(e){var t=!1;if(e)for(var n=0;n<r.connections.length;n++)if(r.connections[n].endpoints[1]==e){t=!0;break}return t},this.isFloating=function(){return p!=null},this.connectorSelector=function(){var e=r.connections[0];return r.isTarget&&e?e:r.connections.length<L||L==-1?null:e},this.isFull=function(){return!(r.isFloating()||L<1||r.connections.length<L)},this.setDragAllowedWhenFull=function(e){A=e},this.setStyle=r.setPaintStyle,this.equals=function(e){return this.anchor.equals(e.anchor)};var M=function(e){var t=0;if(e!=null)for(var n=0;n<r.connections.length;n++)if(r.connections[n].sourceId==e||r.connections[n].targetId==e){t=n;break}return r.connections[t]};this.paint=function(e){e=e||{};var t=e.timestamp,n=e.recalc!==!1;if(!t||r.timestamp!==t){dt({elId:g,timestamp:t,recalc:n});var i=e.offset||j[g];if(i){var s=e.anchorPoint,o=e.connectorPaintStyle;if(s==null){var u=e.dimensions||U[g];if(i==null||u==null)dt({elId:g,timestamp:t}),i=j[g],u=U[g];var a={xy:[i.left,i.top],wh:u,element:r,timestamp:t};if(n&&r.anchor.isDynamic&&r.connections.length>0){var f=M(e.elementWithPrecedence
),l=f.endpoints[0]==r?1:0,c=l==0?f.sourceId:f.targetId,h=j[c],p=U[c];a.txy=[h.left,h.top],a.twh=p,a.tElement=f.endpoints[l]}s=r.anchor.compute(a)}var d=E.compute(s,r.anchor.getOrientation(r),r.paintStyleInUse,o||r.paintStyleInUse);E.paint(d,r.paintStyleInUse,r.anchor),r.timestamp=t;for(var v=0;v<r.overlays.length;v++){var m=r.overlays[v];m.isVisible&&(r.overlayPlacements[v]=m.draw(r.endpoint,r.paintStyleInUse,d))}}}},this.repaint=this.paint,this.removeConnection=this.detach;if(O.CurrentLibrary.isDragSupported(f)){var _={id:null,element:null},D=null,F=!1,q=null,R=mn(_),V=function(){D=r.connectorSelector();var e=!0;r.isEnabled()||(e=!1),D==null&&!t.isSource&&(e=!1),t.isSource&&r.isFull()&&!A&&(e=!1),D!=null&&!D.isDetachable()&&(e=!1);if(e===!1)return O.CurrentLibrary.stopDrag&&O.CurrentLibrary.stopDrag(),R.stopDrag(),!1;D&&!r.isFull()&&t.isSource&&(D=null),dt({elId:g}),d=r.makeInPlaceCopy(),d.referenceEndpoint=r,d.paint(),yn(_,r.parent);var n=v(d.canvas),i=m(n,b),s=Gt([i.left,i.top],d.canvas);O.CurrentLibrary.setOffset(_.element,{left:s[0],top:s[1]}),r.parentAnchor&&(r.anchor=b.makeAnchor(r.parentAnchor,r.elementId,b)),c(v(r.canvas),"dragId",_.id),c(v(r.canvas),"elId",g),t.proxy&&r.setPaintStyle(t.proxy.paintStyle),p=gn(r.getPaintStyle(),r.anchor,E,r.canvas,_.element);if(D==null)r.anchor.locked=!0,r.setHover(!1,!1),D=tt({sourceEndpoint:r,targetEndpoint:p,source:r.endpointWillMoveTo||v(f),target:_.element,anchors:[r.anchor,p.anchor],paintStyle:t.connectorStyle,hoverPaintStyle:t.connectorHoverStyle,connector:t.connector,overlays:t.connectorOverlays,type:r.connectionType,cssClass:r.connectorClass,hoverClass:r.connectorHoverClass});else{F=!0,D.connector.setHover(!1,!1),et(v(d.canvas),!1,!0);var o=D.endpoints[0].id==r.id?0:1;D.floatingAnchorIndex=o,r.detachFromConnection(D);var u=v(r.canvas),a=O.CurrentLibrary.getDragScope(u);c(u,"originalScope",a);var l=O.CurrentLibrary.getDropScope(u);O.CurrentLibrary.setDragScope(u,l),o==0?(q=[D.source,D.sourceId,Z,a],D.source=_.element,D.sourceId=_.id):(q=[D.target,D.targetId,Z,a],D.target=_.element,D.targetId=_.id),D.endpoints[o==0?1:0].anchor.locked=!0,D.suspendedEndpoint=D.endpoints[o],D.suspendedEndpoint.setHover(!1),p.referenceEndpoint=D.suspendedEndpoint,D.endpoints[o]=p,bt(D)}I[_.id]=D,p.addConnection(D),X(H,_.id,p),b.currentlyDragging=!0},$=O.CurrentLibrary,J=t.dragOptions||{},K=O.extend({},$.defaultDragOptions),Q=$.dragEvents.start,G=$.dragEvents.stop,Y=$.dragEvents.drag;J=O.extend(K,J),J.scope=J.scope||r.scope,J[Q]=gt(J[Q],V),J[Y]=gt(J[Y],R.drag),J[G]=gt(J[G],function(){var e=$.getDropEvent(arguments);b.currentlyDragging=!1,n(H[_.id],function(e){return e.id==p.id}),ft([_.element[0],p.canvas],f),at(d.canvas,f),b.anchorManager.clearFor(_.id);var t=D.floatingAnchorIndex==null?1:D.floatingAnchorIndex;D.endpoints[t==0?1:0].anchor.locked=!1,r.setPaintStyle(k);if(D.endpoints[t]==p)if(F&&D.suspendedEndpoint){t==0?(D.source=q[0],D.sourceId=q[1]):(D.target=q[0],D.targetId=q[1]),O.CurrentLibrary.setDragScope(q[2],q[3]),D.endpoints[t]=D.suspendedEndpoint;if(D.isReattach()||D._forceReattach||D._forceDetach||!D.endpoints[t==0?1:0].detach(D,!1,!1,!0,e))D.setHover(!1),D.floatingAnchorIndex=null,D.suspendedEndpoint.addConnection(D),b.repaint(q[1]);D._forceDetach=null,D._forceReattach=null}else ft(D.connector.getDisplayElements(),r.parent),r.detachFromConnection(D);r.anchor.locked=!1,r.paint({recalc:!1}),D.setHover(!1,!1),wt(D),D=null,d=null,delete H[p.elementId],p.anchor=null,p=null,b.currentlyDragging=!1});var Z=v(r.canvas);O.CurrentLibrary.initDraggable(Z,J,!0)}var et=function(e,n,i,s){if((t.isTarget||n)&&O.CurrentLibrary.isDropSupported(f)){var o=t.dropOptions||b.Defaults.DropOptions||O.Defaults.DropOptions;o=O.extend({},o),o.scope=o.scope||r.scope;var u=O.CurrentLibrary.dragEvents.drop,a=O.CurrentLibrary.dragEvents.over,c=O.CurrentLibrary.dragEvents.out,h=function(){var e=O.CurrentLibrary.getDropEvent(arguments),t=v(O.CurrentLibrary.getDragObject(arguments)),n=l(t,"dragId"),i=l(t,"elId"),o=l(t,"originalScope"),u=I[n],a=u.suspendedEndpoint&&(u.suspendedEndpoint.id==r.id||r.referenceEndpoint&&u.suspendedEndpoint.id==r.referenceEndpoint.id);if(a){u._forceReattach=!0;return}if(u!=null){var f=u.floatingAnchorIndex==null?1:u.floatingAnchorIndex,c=f==0?1:0;o&&O.CurrentLibrary.setDragScope(t,o);var h=s!=null?s.isEnabled():!0;r.isFull()&&r.fire("maxConnections",{endpoint:r,connection:u,maxConnections:L},e);if(!r.isFull()&&(f!=0||!!r.isSource)&&(f!=1||!!r.isTarget)&&h){var p=!0;if(u.suspendedEndpoint&&u.suspendedEndpoint.id!=r.id){f==0?(u.source=u.suspendedEndpoint.element,u.sourceId=u.suspendedEndpoint.elementId):(u.target=u.suspendedEndpoint.element,u.targetId=u.suspendedEndpoint.elementId);if(!u.isDetachAllowed(u)||!u.endpoints[f].isDetachAllowed(u)||!u.suspendedEndpoint.isDetachAllowed(u)||!b.checkCondition("beforeDetach",u))p=!1}f==0?(u.source=r.element,u.sourceId=r.elementId):(u.target=r.element,u.targetId=r.elementId),p=p&&r.isDropAllowed(u.sourceId,u.targetId,u.scope,u,r);if(p){u.endpoints[f].detachFromConnection(u),u.suspendedEndpoint&&u.suspendedEndpoint.detachFromConnection(u),u.endpoints[f]=r,r.addConnection(u);var d=r.getParameters();for(var m in d)u.setParameter(m,d[m]);if(!u.suspendedEndpoint)d.draggable&&O.CurrentLibrary.initDraggable(r.element,J,!0);else{var g=u.suspendedEndpoint.getElement(),y=u.suspendedEndpoint.elementId;yt({source:f==0?g:u.source,target:f==1?g:u.target,sourceId:f==0?y:u.sourceId,targetId:f==1?y:u.targetId,sourceEndpoint:f==0?u.suspendedEndpoint:u.endpoints[0],targetEndpoint:f==1?u.suspendedEndpoint:u.endpoints[1],connection:u},!0,e)}nt(u,null,e)}else u.suspendedEndpoint&&(u.endpoints[f]=u.suspendedEndpoint,u.setHover(!1),u._forceDetach=!0,f==0?(u.source=u.suspendedEndpoint.element,u.sourceId=u.suspendedEndpoint.elementId):(u.target=u.suspendedEndpoint.element,u.targetId=u.suspendedEndpoint.elementId),u.suspendedEndpoint.addConnection(u),u.endpoints[0].repaint(),u.repaint(),b.repaint(u.source.elementId),u._forceDetach=!1);u.floatingAnchorIndex=null}b.currentlyDragging=!1,delete I[n],u.suspendedEndpoint=null}};o[u]=gt(o[u],h),o[a]=gt(o[a],function(){var e=O.CurrentLibrary.getDragObject(arguments),t=l(v(e),"dragId"),n=I[t];if(n!=null){var i=n.floatingAnchorIndex==null?1:n.floatingAnchorIndex,s=r.isTarget&&n.floatingAnchorIndex!=0||n.suspendedEndpoint&&r.referenceEndpoint&&r.referenceEndpoint.id==n.suspendedEndpoint.id;s&&n.endpoints[i].anchor.over(r.anchor)}}),o[c]=gt(o[c],function(){var e=O.CurrentLibrary.getDragObject(arguments),t=l(v(e),"dragId"),n=I[t];if(n!=null){var i=n.floatingAnchorIndex==null?1:n.floatingAnchorIndex,s=r.isTarget&&n.floatingAnchorIndex!=0||n.suspendedEndpoint&&r.referenceEndpoint&&r.referenceEndpoint.id==n.suspendedEndpoint.id;s&&n.endpoints[i].anchor.out()}}),O.CurrentLibrary.initDroppable(e,o,!0,i)}};return et(v(r.canvas),!0,!t._transient&&!r.anchor.isFloating,r),t.type&&r.addType(t.type),r}},O=new A;typeof window!="undefined"&&(window.jsPlumb=O),O.getInstance=function(e){var t=new A(e);return t.init(),t};var M=function(e,t,n,r,i,s){return function(o){o=o||{};var u=o.jsPlumbInstance.makeAnchor([e,t,n,r,0,0],o.elementId,o.jsPlumbInstance);return u.type=i,s&&s(u,o),u}};O.Anchors.TopCenter=M(.5,0,0,-1,"TopCenter"),O.Anchors.BottomCenter=M(.5,1,0,1,"BottomCenter"),O.Anchors.LeftMiddle=M(0,.5,-1,0,"LeftMiddle"),O.Anchors.RightMiddle=M(1,.5,1,0,"RightMiddle"),O.Anchors.Center=M(.5,.5,0,0,"Center"),O.Anchors.TopRight=M(1,0,0,-1,"TopRight"),O.Anchors.BottomRight=M(1,1,0,1,"BottomRight"),O.Anchors.TopLeft=M(0,0,0,-1,"TopLeft"),O.Anchors.BottomLeft=M(0,1,0,1,"BottomLeft"),O.Defaults.DynamicAnchors=function(e){return e.jsPlumbInstance.makeAnchors(["TopCenter","RightMiddle","BottomCenter","LeftMiddle"],e.elementId,e.jsPlumbInstance)},O.Anchors.AutoDefault=function(e){var t=e.jsPlumbInstance.makeDynamicAnchor(O.Defaults.DynamicAnchors(e));return t.type="AutoDefault",t},O.Anchors.Assign=M(0,0,0,0,"Assign",function(e,t){var n=t.position||"Fixed";e.positionFinder=n.constructor==String?t.jsPlumbInstance.AnchorPositionFinders[n]:n,e.constructorParams=t}),O.Anchors.Continuous=function(e){return e.jsPlumbInstance.continuousAnchorFactory.get(e)},O.AnchorPositionFinders={Fixed:function(e,t,n,r){return[(e.left-t.left)/n[0],(e.top-t.top)/n[1]]},Grid:function(e,t,n,r){var i=e.left-t.left,s=e.top-t.top,o=n[0]/r.grid[0],u=n[1]/r.grid[1],a=Math.floor(i/o),f=Math.floor(s/u);return[(a*o+o/2)/n[0],(f*u+u/2)/n[1]]}},O.Anchors.Perimeter=function(e){e=e||{};var t=e.anchorCount||60,n=e.shape;if(!n)throw new Error("no shape supplied to Perimeter Anchor type");var r=function(){var e=.5,n=Math.PI*2/t,r=0,i=[];for(var s=0;s<t;s++){var o=e+e*Math.sin(r),u=e+e*Math.cos(r);i.push([o,u,0,0]),r+=n}return i},i=function(e){var n=t/e.length,r=[],i=function(e,i,s,o,u){n=t*u;var a=(s-e)/n,f=(o-i)/n;for(var l=0;l<n;l++)r.push([e+a*l,i+f*l,0,0])};for(var s=0;s<e.length;s++)i.apply(null,e[s]);return r},s=function(e){var t=[];for(var n=0;n<e.length;n++)t.push([e[n][0],e[n][1],e[n][2],e[n][3],1/e.length]);return i(t)},o=function(){return s([[0,0,1,0],[1,0,1,1],[1,1,0,1],[0,1,0,0]])},u={circle:r,ellipse:r,diamond:function(){return s([[.5,0,1,.5],[1,.5,.5,1],[.5,1,0,.5],[0,.5,.5,0]])},rectangle:o,square:o,triangle:function(){return s([[.5,0,1,1],[1,1,0,1],[0,1,.5,0]])},path:function(e){var t=e.points,n=[],r=0;for(var s=0;s<t.length-1;s++){var o=Math.sqrt(Math.pow(t[s][2]-t[s][0])+Math.pow(t[s][3]-t[s][1]));r+=o,n.push([t[s][0],t[s][1],t[s+1][0],t[s+1][1],o])}for(var s=0;s<n.length;s++)n[s][4]=n[s][4]/r;return i(n)}},a=function(e,t){var n=[],r=t/180*Math.PI;for(var i=0;i<e.length;i++){var s=e[i][0]-.5,o=e[i][1]-.5;n.push([.5+(s*Math.cos(r)-o*Math.sin(r)),.5+(s*Math.sin(r)+o*Math.cos(r)),e[i][2],e[i][3]])}return n};if(!u[n])throw new Error("Shape ["+n+"] is unknown by Perimeter Anchor type");var f=u[n](e);e.rotation&&(f=a(f,e.rotation));var l=e.jsPlumbInstance.makeDynamicAnchor(f);return l.type="Perimeter",l}}(),function(){jsPlumb.DOMElementComponent=function(e){jsPlumb.jsPlumbUIComponent.apply(this,arguments),this.mousemove=this.dblclick=this.click=this.mousedown=this.mouseup=function(e){}},jsPlumb.Connectors.Straight=function(){this.type="Straight";var e=this,t=null,n,r,i,s,o,u,a,f,l,c,h,p,d;this.compute=function(e,p,v,m,g,y,b,w){var E=Math.abs(e[0]-p[0]),S=Math.abs(e[1]-p[1]),x=.45*E,T=.45*S;E*=1.9,S*=1.9;var N=Math.min(e[0],p[0])-x,C=Math.min(e[1],p[1])-T,k=Math.max(2*b,w);return E<k&&(E=k,N=e[0]+(p[0]-e[0])/2-k/2,x=(E-Math.abs(e[0]-p[0]))/2),S<k&&(S=k,C=e[1]+(p[1]-e[1])/2-k/2,T=(S-Math.abs(e[1]-p[1]))/2),f=e[0]<p[0]?x:E-x,l=e[1]<p[1]?T:S-T,c=e[0]<p[0]?E-x:x,h=e[1]<p[1]?S-T:T,t=[N,C,E,S,f,l,c,h],s=c-f,o=h-l,n=jsPlumbUtil.gradient({x:f,y:l},{x:c,y:h}),r=-1/n,i=-1*(n*f-l),u=Math.atan(n),a=Math.atan(r),d=Math.sqrt(s*s+o*o),t},this.pointOnPath=function(e,t){if(e==0&&!t)return{x:f,y:l};if(e==1&&!t)return{x:c,y:h};var n=t?e>0?e:d+e:e*d;return jsPlumbUtil.pointOnLine({x:f,y:l},{x:c,y:h},n)},this.gradientAtPoint=function(e){return n},this.pointAlongPathFrom=function(t,n,r){var i=e.pointOnPath(t,r),s=t==1?{x:f+(c-f)*10,y:l+(l-h)*10}:{x:c,y:h};return jsPlumbUtil.pointOnLine(i,s,n)}},jsPlumb.Connectors.Bezier=function(e){var t=this;e=e||{},this.majorAnchor=e.curviness||150,this.minorAnchor=10;var n=null;this.type="Bezier",this._findControlPoint=function(e,n,r,i,s,o,u){var a=o.getOrientation(i),f=u.getOrientation(s),l=a[0]!=f[0]||a[1]==f[1],c=[],h=t.majorAnchor,p=t.minorAnchor;return l?(f[0]==0?c.push(r[0]<n[0]?e[0]+p:e[0]-p):c.push(e[0]+h*f[0]),f[1]==0?c.push(r[1]<n[1]?e[1]+p:e[1]-p):c.push(e[1]+h*a[1])):(a[0]==0?c.push(n[0]<r[0]?e[0]+p:e[0]-p):c.push(e[0]-h*a[0]),a[1]==0?c.push(n[1]<r[1]?e[1]+p:e[1]-p):c.push(e[1]+h*f[1])),c};var r,i,s,o,u,s,a,f,l,c,h,p,d,v,m;this.compute=function(e,p,d,v,m,g,y,b){y=y||0,c=Math.abs(e[0]-p[0])+y,h=Math.abs(e[1]-p[1])+y,f=Math.min(e[0],p[0])-y/2,l=Math.min(e[1],p[1])-y/2,s=e[0]<p[0]?c-y/2:y/2,a=e[1]<p[1]?h-y/2:y/2,o=e[0]<p[0]?y/2:c-y/2,u=e[1]<p[1]?y/2:h-y/2,r=t._findControlPoint([s,a],e,p,d,v,m,g),i=t._findControlPoint([o,u],p,e,v,d,g,m);var w=Math.min(s,o),E=Math.min(r[0],i[0]),S=Math.min(w,E),x=Math.max(s,o),T=Math.max(r[0],i[0]),N=Math.max(x,T);N>c&&(c=N);if(S<0){f+=S;var C=Math.abs(S);c+=C,r[0]+=C,s+=C,o+=C,i[0]+=C}var k=Math.min(a,u),L=Math.min(r[1],i[1]),A=Math.min(k,L),O=Math.max(a,u),M=Math.max(r[1],i[1]),_=Math.max(O,M);_>h&&(h=_);if(A<0){l+=A;var D=Math.abs(A);h+=D,r[1]+=D,a+=D,u+=D,i[1]+=D}if(b&&c<b){var P=(b-c)/2;c=b,f-=P,s+=P,o+=P,r[0]=r[0]+P,i[0]=i[0]+P}if(b&&h<b){var P=(b-h)/2;h=b,l-=P,a+=P,u+=P,r[1]=r[1]+P,i[1]=i[1]+P}return n=[f,l,c,h,s,a,o,u,r[0],r[1],i[0],i[1]],n};var g=function(){return[{x:s,y:a},{x:r[0],y:r[1]},{x:i[0],y:i[1]},{x:o,y:u}]},y=function(e,t,n){return n&&(t=jsBezier.locationAlongCurveFrom(e,t>0?0:1,t)),t};this.pointOnPath=function(e,t){var n=g();return e=y(n,e,t),jsBezier.pointOnCurve(n,e)},this.gradientAtPoint=function(e,t){var n=g();return e=y(n,e,t),jsBezier.gradientAtPoint(n,e)},this.pointAlongPathFrom=function(e,t,n){var r=g();return e=y(r,e,n),jsBezier.pointAlongCurveFrom(r,e,t)}},jsPlumb.Connectors.Flowchart=function(e){this.type="Flowchart",e=e||{};var t=this,n=e.stub||e.minStubLength||30,r=jsPlumbUtil.isArray(n)?n[0]:n,i=jsPlumbUtil.isArray(n)?n[1]:n,s=e.gap||0,o=[],u=0,a=[],f=[],l=[],c,h,p=-Infinity,d=-Infinity,v=Infinity,m=Infinity,g=e.grid,y=function(e,t){var n=e%t,r=Math.floor(e/t),i=n>t/2?1:0;return(r+i)*t},b=function(e,t,n,r){return[n||g==null?e:y(e,g[0]),r||g==null?t:y(t,g[1])]},w=function(e,t,n,r){var i=0;for(var s=0;s<o.length;s++)f[s]=o[s][5]/u,a[s]=[i,i+=o[s][5]/u]},E=function(){l.push(o.length);for(var e=0;e<o.length;e++)l.push(o[e][0]),l.push(o[e][1])},S=function(e,t,n,r,i,s){var a=o.length==0?n:o[o.length-1][0],f=o.length==0?r:o[o.length-1][1],l=e==a?Infinity:0,c=Math.abs(e==a?t-f:e-a);o.push([e,t,a,f,l,c]),u+=c,p=Math.max(p,e),d=Math.max(d,t),v=Math.min(v,e),m=Math.min(m,t)},x=function(e,t){t&&(e=e>0?e/u:(u+e)/u);var n=a.length-1,r=1;for(var i=0;i<a.length;i++)if(a[i][1]>=e){n=i,r=(e-a[i][0])/f[i];break}return{segment:o[n],proportion:r,index:n}};this.compute=function(e,n,g,y,b,x,T,N,C,k){o=[],a=[],u=0,f=[],p=d=-Infinity,v=m=Infinity,t.lineWidth=T,c=n[0]<e[0],h=n[1]<e[1];var L=T||1,A=L/2+(r+i),O=L/2+(i+r),M=L/2+(r+i),_=L/2+(i+r),D=b.orientation||b.getOrientation(g),P=x.orientation||x.getOrientation(y),H=c?n[0]:e[0],B=h?n[1]:e[1],j=Math.abs(n[0]-e[0])+A+O,F=Math.abs(n[1]-e[1])+M+_;if(D[0]==0&&D[1]==0||P[0]==0&&P[1]==0){var I=j>F?0:1,q=[1,0][I];D=[],P=[],D[I]=e[I]>n[I]?-1:1,P[I]=e[I]>n[I]?1:-1,D[q]=0,P[q]=0}var R=c?j-O+s*D[0]:A+s*D[0],U=h?F-_+s*D[1]:M+s*D[1],z=c?A+s*P[0]:j-O+s*P[0],W=h?M+s*P[1]:F-_+s*P[1],X=R+D[0]*r,V=U+D[1]*r,$=z+P[0]*i,J=W+P[1]*i,K=Math.abs(R-z)>r+i,Q=Math.abs(U-W)>r+i,G=X+($-X)/2,Y=V+(J-V)/2,Z=D[0]*P[0]+D[1]*P[1],et=Z==-1,tt=Z==0,nt=Z==1;H-=A,B-=M,l=[H,B,j,F,R,U,z,W];var rt=[],it=D[0]==0?"y":"x",st=et?"opposite":nt?"orthogonal":"perpendicular",ot=jsPlumbUtil.segment([R,U],[z,W]),ut=D[it=="x"?0:1]==-1,at={x:[null,4,3,2,1],y:[null,2,1,4,3]};ut&&(ot=at[it][ot]),S(X,V,R,U,z,W);var ft=function(e,t,n,s){return e+(t*(1-n)*s+Math.max(r,i))},lt={oppositex:function(){if(g.elementId==y.elementId){var e=V+(1-b.y)*C.height+Math.max(r,i);return[[X,e],[$,e]]}return!K||ot!=1&&ot!=2?[[X,Y],[$,Y]]:[[G,U],[G,W]]},orthogonalx:function(){return ot==1||ot==2?[[$,V]]:[[X,J]]},perpendicularx:function(){var e=(W+U)/2;if(ot==1&&P[1]==1||ot==2&&P[1]==-1)return Math.abs(z-R)>Math.max(r,i)?[[$,V]]:[[X,V],[X,e],[$,e]];if(ot==3&&P[1]==-1||ot==4&&P[1]==1)return[[X,e],[$,e]];if(ot==3&&P[1]==1||ot==4&&P[1]==-1)return[[X,J]];if(ot==1&&P[1]==-1||ot==2&&P[1]==1)return Math.abs(z-R)>Math.max(r,i)?[[G,V],[G,J]]:[[X,J]]},oppositey:function(){if(g.elementId==y.elementId){var e=X+(1-b.x)*C.width+Math.max(r,i);return[[e,V],[e,J]]}return!Q||ot!=2&&ot!=3?[[G,V],[G,J]]:[[R,Y],[z,Y]]},orthogonaly:function(){return ot==2||ot==3?[[X,J]]:[[$,V]]},perpendiculary:function(){var e=(z+R)/2;if(ot==2&&P[0]==-1||ot==3&&P[0]==1)return Math.abs(z-R)>Math.max(r,i)?[[X,J]]:[[X,Y],[$,Y]];if(ot==1&&P[0]==-1||ot==4&&P[0]==1){var e=(z+R)/2;return[[e,V],[e,J]]}if(ot==1&&P[0]==1||ot==4&&P[0]==-1)return[[$,V]];if(ot==2&&P[0]==1||ot==3&&P[0]==-1)return Math.abs(W-U)>Math.max(r,i)?[[X,Y],[$,Y]]:[[$,V]]}},ct=lt[st+it]();if(ct)for(var ht=0;ht<ct.length;ht++)S(ct[ht][0],ct[ht][1],R,U,z,W);return S($,J,R,U,z,W),S(z,W,R,U,z,W),E(),w(R,U,z,W),d>l[3]&&(l[3]=d+T*2),p>l[2]&&(l[2]=p+T*2),l},this.pointOnPath=function(e,n){return t.pointAlongPathFrom(e,0,n)},this.gradientAtPoint=function(e,t){return o[x(e,t).index][4]},this.pointAlongPathFrom=function(e,t,n){var r=x(e,n),i=r.segment,s=r.proportion,u=o[r.index][5],a=o[r.index][4],f={x:a==Infinity?i[2]:i[2]>i[0]?i[0]+(1-s)*u-t:i[2]+s*u+t,y:a==0?i[3]:i[3]>i[1]?i[1]+(1-s)*u-t:i[3]+s*u+t,segmentInfo:r};return f}},jsPlumb.Endpoints.Dot=function(e){this.type="Dot";var t=this;e=e||{},this.radius=e.radius||10,this.defaultOffset=.5*this.radius,this.defaultInnerRadius=this.radius/3,this.compute=function(e,n,r,i){var s=r.radius||t.radius,o=e[0]-s,u=e[1]-s;return[o,u,s*2,s*2,s]}},jsPlumb.Endpoints.Rectangle=function(e){this.type="Rectangle";var t=this;e=e||{},this.width=e.width||20,this.height=e.height||20,this.compute=function(e,n,r,i){var s=r.width||t.width,o=r.height||t.height,u=e[0]-s/2,a=e[1]-o/2;return[u,a,s,o]}};var e=function(e){jsPlumb.DOMElementComponent.apply(this,arguments);var t=this,n=[];this.getDisplayElements=function(){return n},this.appendDisplayElement=function(e){n.push(e)}};jsPlumb.Endpoints.Image=function(t){this.type="Image",e.apply(this,arguments);var n=this,r=!1,i=!1,s=t.width,o=t.height,u=null,a=t.endpoint;this.img=new Image,n.ready=!1,this.img.onload=function(){n.ready=!0,s=s||n.img.width,o=o||n.img.height,u&&u(n)},a.setImage=function(e,t){var r=e.constructor==String?e:e.src;u=t,n.img.src=e,n.canvas!=null&&n.canvas.setAttribute("src",e)},a.setImage(t.src||t.url,t.onload),this.compute=function(e,t,r,i){return n.anchorPoint=e,n.ready?[e[0]-s/2,e[1]-o/2,s,o]:[0,0,0,0]},n.canvas=document.createElement("img"),r=!1,n.canvas.style.margin=0,n.canvas.style.padding=0,n.canvas.style.outline=0,n.canvas.style.position="absolute";var f=t.cssClass?" "+t.cssClass:"";n.canvas.className=jsPlumb.endpointClass+f,s&&n.canvas.setAttribute("width",s),o&&n.canvas.setAttribute("height",o),jsPlumb.appendElement(n.canvas,t.parent),n.attachListeners(n.canvas,n),n.cleanup=function(){i=!0};var l=function(e,t,u){if(!i){r||(n.canvas.setAttribute("src",n.img.src),n.appendDisplayElement(n.canvas),r=!0);var a=n.anchorPoint[0]-s/2,f=n.anchorPoint[1]-o/2;jsPlumb.sizeCanvas(n.canvas,a,f,s,o)}};this.paint=function(e,t,r){n.ready?l(e,t,r):window.setTimeout(function(){n.paint(e,t,r)},200)}},jsPlumb.Endpoints.Blank=function(t){var n=this;this.type="Blank",e.apply(this,arguments),this.compute=function(e,t,n,r){return[e[0],e[1],10,0]},n.canvas=document.createElement("div"),n.canvas.style.display="block",n.canvas.style.width="1px",n.canvas.style.height="1px",n.canvas.style.background="transparent",n.canvas.style.position="absolute",n.canvas.className=n._jsPlumb.endpointClass,jsPlumb.appendElement(n.canvas,t.parent),this.paint=function(e,t,r){jsPlumb.sizeCanvas(n.canvas,e[0],e[1],e[2],e[3])}},jsPlumb.Endpoints.Triangle=function(e){this.type="Triangle",e=e||{},e.width=e.width||55,e.height=e.height||55,this.width=e.width,this.height=e.height,this.compute=function(e,t,n,r){var i=n.width||self.width,s=n.height||self.height,o=e[0]-i/2,u=e[1]-s/2;return[o,u,i,s]}};var t=function(e){var t=!0,n=this;this.isAppendedAtTopLevel=!0,this.component=e.component,this.loc=e.location==null?.5:e.location,this.endpointLoc=e.endpointLocation==null?[.5,.5]:e.endpointLocation,this.setVisible=function(e){t=e,n.component.repaint()},this.isVisible=function(){return t},this.hide=function(){n.setVisible(!1)},this.show=function(){n.setVisible(!0)},this.incrementLocation=function(e){n.loc+=e,n.component.repaint()},this.setLocation=function(e){n.loc=e,n.component.repaint()},this.getLocation=function(){return n.loc}};jsPlumb.Overlays.Arrow=function(e){this.type="Arrow",t.apply(this,arguments),this.isAppendedAtTopLevel=!1,e=e||{};var n=this;this.length=e.length||20,this.width=e.width||20,this.id=e.id;var r=(e.direction||1)<0?-1:1,i=e.paintStyle||{lineWidth:1},s=e.foldback||.623;this.computeMaxSize=function(){return n.width*1.5},this.cleanup=function(){},this.draw=function(e,t,o){var u,a,f,l,c;if(e.pointAlongPathFrom){if(jsPlumbUtil.isString(n.loc)||n.loc>1||n.loc<0){var h=parseInt(n.loc);u=e.pointAlongPathFrom(h,r*n.length/2,!0),a=e.pointOnPath(h,!0),f=jsPlumbUtil.pointOnLine(u,a,n.length)}else n.loc==1?(u=e.pointOnPath(n.loc),a=e.pointAlongPathFrom(n.loc,-1),f=jsPlumbUtil.pointOnLine(u,a,n.length)):n.loc==0?(f=e.pointOnPath(n.loc),a=e.pointAlongPathFrom(n.loc,1),u=jsPlumbUtil.pointOnLine(f,a,n.length)):(u=e.pointAlongPathFrom(n.loc,r*n.length/2),a=e.pointOnPath(n.loc),f=jsPlumbUtil.pointOnLine(u,a,n.length));l=jsPlumbUtil.perpendicularLineTo(u,f,n.width),c=jsPlumbUtil.pointOnLine(u,f,s*n.length);var p=Math.min(u.x,l[0].x,l[1].x),d=Math.max(u.x,l[0].x,l[1].x),v=Math.min(u.y,l[0].y,l[1].y),m=Math.max(u.y,l[0].y,l[1].y),g={hxy:u,tail:l,cxy:c},y=i.strokeStyle||t.strokeStyle,b=i.fillStyle||t.strokeStyle,w=i.lineWidth||t.lineWidth;return n.paint(e,g,w,y,b,o),[p,d,v,m]}return[0,0,0,0]}},jsPlumb.Overlays.PlainArrow=function(e){e=e||{};var t=jsPlumb.extend(e,{foldback:1});jsPlumb.Overlays.Arrow.call(this,t),this.type="PlainArrow"},jsPlumb.Overlays.Diamond=function(e){e=e||{};var t=e.length||40,n=jsPlumb.extend(e,{length:t/2,foldback:2});jsPlumb.Overlays.Arrow.call(this,n),this.type="Diamond"};var n=function(e){jsPlumb.DOMElementComponent.apply(this,arguments),t.apply(this,arguments);var n=this,r=!1;e=e||{},this.id=e.id;var i,s=function(){i=e.create(e.component),i=jsPlumb.CurrentLibrary.getDOMElement(i),i.style.position="absolute";var t=e._jsPlumb.overlayClass+" "+(n.cssClass?n.cssClass:e.cssClass?e.cssClass:"");i.className=t,jsPlumb.appendElement(i,e.component.parent),e._jsPlumb.getId(i),n.attachListeners(i,n),n.canvas=i};this.getElement=function(){return i==null&&s(),i},this.getDimensions=function(){return jsPlumb.CurrentLibrary.getSize(jsPlumb.CurrentLibrary.getElementObject(n.getElement()))};var o=null,u=function(e){return o==null&&(o=n.getDimensions()),o};this.clearCachedDimensions=function(){o=null},this.computeMaxSize=function(){var e=u();return Math.max(e[0],e[1])};var a=n.setVisible;n.setVisible=function(e){a(e),i.style.display=e?"block":"none"},this.cleanup=function(){i!=null&&jsPlumb.CurrentLibrary.removeElement(i)},this.paint=function(e,t,s){r||(n.getElement(),e.appendDisplayElement(i),n.attachListeners(i,e),r=!0),i.style.left=s[0]+t.minx+"px",i.style.top=s[1]+t.miny+"px"},this.draw=function(e,t,r){var i=u();if(i!=null&&i.length==2){var s={x:0,y:0};if(e.pointOnPath){var o=n.loc,a=!1;if(jsPlumbUtil.isString(n.loc)||n.loc<0||n.loc>1)o=parseInt(n.loc),a=!0;s=e.pointOnPath(o,a)}else{var f=n.loc.constructor==Array?n.loc:n.endpointLoc;s={x:f[0]*r[2],y:f[1]*r[3]}}return minx=s.x-i[0]/2,miny=s.y-i[1]/2,n.paint(e,{minx:minx,miny:miny,td:i,cxy:s},r),[minx,minx+i[0],miny,miny+i[1]]}return[0,0,0,0]},this.reattachListeners=function(e){i&&n.reattachListenersForElement(i,n,e)}};jsPlumb.Overlays.Custom=function(e){this.type="Custom",n.apply(this,arguments)},jsPlumb.Overlays.Label=function(e){var t=this;this.labelStyle=e.labelStyle||jsPlumb.Defaults.LabelStyle,this.cssClass=this.labelStyle!=null?this.labelStyle.cssClass:null,e.create=function(){return document.createElement("div")},jsPlumb.Overlays.Custom.apply(this,arguments),this.type="Label";var n=e.label||"",t=this,r=null;this.setLabel=function(e){n=e,r=null,t.clearCachedDimensions(),i(),t.component.repaint()};var i=function(){if(typeof n=="function"){var e=n(t);t.getElement().innerHTML=e.replace(/\r\n/g,"<br/>")}else r==null&&(r=n,t.getElement().innerHTML=r.replace(/\r\n/g,"<br/>"))};this.getLabel=function(){return n};var s=this.getDimensions;this.getDimensions=function(){return i(),s()}}}(),function(){var e=function(e,t,n,r){this.m=(r-t)/(n-e),this.b=-1*(this.m*e-t),this.rectIntersect=function(e,t,n,r){var i=[],s=(t-this.b)/this.m;s>=e&&s<=e+n&&i.push([s,this.m*s+this.b]);var o=this.m*(e+n)+this.b;o>=t&&o<=t+r&&i.push([(o-this.b)/this.m,o]);var s=(t+r-this.b)/this.m;s>=e&&s<=e+n&&i.push([s,this.m*s+this.b]);var o=this.m*e+this.b;o>=t&&o<=t+r&&i.push([(o-this.b)/this.m,o]);if(i.length==2){var u=(i[0][0]+i[1][0])/2,a=(i[0][1]+i[1][1])/2;i.push([u,a]);var f=u<=e+n/2?-1:1,l=a<=t+r/2?-1:1;return i.push([f,l]),i}return null}},t=function(e,t,n,r){return e<=n&&r<=t?1:e<=n&&t<=r?2:n<=e&&r>=t?3:4},n=function(e,t,n,r,i,s,o,u,a){if(u<=a)return[e,t];if(n==1)return r[3]<=0&&i[3]>=1?[e+(r[2]<.5?-1*s:s),t]:r[2]>=1&&i[2]<=0?[e,t+(r[3]<.5?-1*o:o)]:[e+ -1*s,t+ -1*o];if(n==2)return r[3]>=1&&i[3]<=0?[e+(r[2]<.5?-1*s:s),t]:r[2]>=1&&i[2]<=0?[e,t+(r[3]<.5?-1*o:o)]:[e+1*s,t+ -1*o];if(n==3)return r[3]>=1&&i[3]<=0?[e+(r[2]<.5?-1*s:s),t]:r[2]<=0&&i[2]>=1?[e,t+(r[3]<.5?-1*o:o)]:[e+ -1*s,t+ -1*o];if(n==4)return r[3]<=0&&i[3]>=1?[e+(r[2]<.5?-1*s:s),t]:r[2]<=0&&i[2]>=1?[e,t+(r[3]<.5?-1*o:o)]:[e+1*s,t+ -1*o]};jsPlumb.Connectors.StateMachine=function(e){var r=this,i=null,s,o,u,a,f=[],l=e.curviness||10,c=e.margin||5,h=e.proximityLimit||80,p=e.orientation&&e.orientation=="clockwise",d=e.loopbackRadius||25,v=!1,m=e.showLoopback!==!1;this.type="StateMachine",e=e||{},this.compute=function(e,r,g,y,b,w,E,S){var x=Math.abs(e[0]-r[0]),T=Math.abs(e[1]-r[1]),N=.45*x,C=.45*T;x*=1.9,T*=1.9,E=E||1;var k=Math.min(e[0],r[0])-N,L=Math.min(e[1],r[1])-C;if(!m||g.elementId!=y.elementId){v=!1,s=e[0]<r[0]?N:x-N,o=e[1]<r[1]?C:T-C,u=e[0]<r[0]?x-N:N,a=e[1]<r[1]?T-C:C,e[2]==0&&(s-=c),e[2]==1&&(s+=c),e[3]==0&&(o-=c),e[3]==1&&(o+=c),r[2]==0&&(u-=c),r[2]==1&&(u+=c),r[3]==0&&(a-=c),r[3]==1&&(a+=c);var A=(s+u)/2,O=(o+a)/2,M=-1*A/O,_=Math.atan(M),D=M==Infinity||M==-Infinity?0:Math.abs(l/2*Math.sin(_)),P=M==Infinity||M==-Infinity?0:Math.abs(l/2*Math.cos(_)),H=t(s,o,u,a),B=Math.sqrt(Math.pow(u-s,2)+Math.pow(a-o,2));f=n(A,O,H,e,r,l,l,B,h);var j=Math.max(Math.abs(f[0]-s)*3,Math.abs(f[0]-u)*3,Math.abs(u-s),2*E,S),F=Math.max(Math.abs(f[1]-o)*3,Math.abs(f[1]-a)*3,Math.abs(a-o),2*E,S);if(x<j){var I=j-x;k-=I/2,s+=I/2,u+=I/2,x=j,f[0]+=I/2}if(T<F){var q=F-T;L-=q/2,o+=q/2,a+=q/2,T=F,f[1]+=q/2}i=[k,L,x,T,s,o,u,a,f[0],f[1]]}else{v=!0;var R=e[0],U=e[0],z=e[1]-c,W=e[1]-c,X=R,V=z-d;x=2*E+4*d,T=2*E+4*d,k=X-d-E-d,L=V-d-E-d,i=[k,L,x,T,X-k,V-L,d,p,R-k,z-L,U-k,W-L]}return i};var g=function(){return[{x:u,y:a},{x:f[0],y:f[1]},{x:f[0]+1,y:f[1]+1},{x:s,y:o}]},y=function(e,t,n){return n&&(t=jsBezier.locationAlongCurveFrom(e,t>0?0:1,t)),t};this.pointOnPath=function(e,t){if(v){if(t){var n=Math.PI*2*d;e/=n}e>0&&e<1&&(e=1-e);var r=e*2*Math.PI+Math.PI/2,s=i[4]+i[6]*Math.cos(r),o=i[5]+i[6]*Math.sin(r);return{x:s,y:o}}var u=g();return e=y(u,e,t),jsBezier.pointOnCurve(u,e)},this.gradientAtPoint=function(e,t){if(v){if(t){var n=Math.PI*2*d;e/=n}return Math.atan(e*2*Math.PI)}var r=g();return e=y(r,e,t),jsBezier.gradientAtPoint(r,e)},this.pointAlongPathFrom=function(e,t,n){if(v){if(n){var r=Math.PI*2*d;e/=r}e>0&&e<1&&(e=1-e);var r=2*Math.PI*i[6],s=t/r*2*Math.PI,o=e*2*Math.PI-s+Math.PI/2,u=i[4]+i[6]*Math.cos(o),a=i[5]+i[6]*Math.sin(o);return{x:u,y:a}}var f=g();return e=y(f,e,n),jsBezier.pointAlongCurveFrom(f,e,t)}},jsPlumb.Connectors.canvas.StateMachine=function(e){e=e||{};var t=this,n=e.drawGuideline||!0,r=e.avoidSelector;jsPlumb.Connectors.StateMachine.apply(this,arguments),jsPlumb.CanvasConnector.apply(this,arguments),this._paint=function(e){if(e.length==10)t.ctx.beginPath(),t.ctx.moveTo(e[4],e[5]),t.ctx.bezierCurveTo(e[8],e[9],e[8],e[9],e[6],e[7]),t.ctx.stroke();else{t.ctx.save(),t.ctx.beginPath();var n=0,r=2*Math.PI,i=e[7];t.ctx.arc(e[4],e[5],e[6],0,r,i),t.ctx.stroke(),t.ctx.closePath(),t.ctx.restore()}},this.createGradient=function(e,t){return t.createLinearGradient(e[4],e[5],e[6],e[7])}},jsPlumb.Connectors.svg.StateMachine=function(){var e=this;jsPlumb.Connectors.StateMachine.apply(this,arguments),jsPlumb.SvgConnector.apply(this,arguments),this.getPath=function(e){return e.length==10?"M "+e[4]+" "+e[5]+" C "+e[8]+" "+e[9]+" "+e[8]+" "+e[9]+" "+e[6]+" "+e[7]:"M"+(e[8]+4)+" "+e[9]+" A "+e[6]+" "+e[6]+" 0 1,0 "+(e[8]-4)+" "+e[9]}},jsPlumb.Connectors.vml.StateMachine=function(){jsPlumb.Connectors.StateMachine.apply(this,arguments),jsPlumb.VmlConnector.apply(this,arguments);var e=jsPlumb.vml.convertValue;this.getPath=function(t){if(t.length==10)return"m"+e(t[4])+","+e(t[5])+" c"+e(t[8])+","+e(t[9])+","+e(t[8])+","+e(t[9])+","+e(t[6])+","+e(t[7])+" e";var n=e(t[8]-t[6]),r=e(t[9]-2*t[6]),i=n+e(2*t[6]),s=r+e(2*t[6]),o=n+","+r+","+i+","+s,u="ar "+o+","+e(t[8])+","+e(t[9])+","+e(t[8])+","+e(t[9])+" e";return u}}}(),function(){var e={"stroke-linejoin":"joinstyle",joinstyle:"joinstyle",endcap:"endcap",miterlimit:"miterlimit"},t=null;if(document.createStyleSheet&&document.namespaces){var n=[".jsplumb_vml","jsplumb\\:textbox","jsplumb\\:oval","jsplumb\\:rect","jsplumb\\:stroke","jsplumb\\:shape","jsplumb\\:group"],r="behavior:url(#default#VML);position:absolute;";t=document.createStyleSheet();for(var i=0;i<n.length;i++)t.addRule(n[i],r);document.namespaces.add("jsplumb","urn:schemas-microsoft-com:vml")}jsPlumb.vml={};var s=1e3,o={},u=function(e,t){var n=jsPlumb.getId(e),r=o[n];return r||(r=f("group",[0,0,s,s],{"class":t}),r.style.backgroundColor="red",o[n]=r,jsPlumb.appendElement(r,e)),r},a=function(e,t){for(var n in t)e[n]=t[n]},f=function(e,t,n,r,i,s){n=n||{};var o=document.createElement("jsplumb:"+e);return s?i.appendElement(o,r):jsPlumb.CurrentLibrary.appendElement(o,r),o.className=(n["class"]?n["class"]+" ":"")+"jsplumb_vml",l(o,t),a(o,n),o},l=function(e,t,n){e.style.left=t[0]+"px",e.style.top=t[1]+"px",e.style.width=t[2]+"px",e.style.height=t[3]+"px",e.style.position="absolute",n&&(e.style.zIndex=n)},c=jsPlumb.vml.convertValue=function(e){return Math.floor(e*s)},h=function(e,t,n,r){"transparent"===t?r.setOpacity(n,"0.0"):r.setOpacity(n,"1.0")},p=function(e,t,n,r){var i={};if(t.strokeStyle){i.stroked="true";var s=jsPlumbUtil.convertStyle(t.strokeStyle,!0);i.strokecolor=s,h(i,s,"stroke",n),i.strokeweight=t.lineWidth+"px"}else i.stroked="false";if(t.fillStyle){i.filled="true";var o=jsPlumbUtil.convertStyle(t.fillStyle,!0);i.fillcolor=o,h(i,o,"fill",n)}else i.filled="false";if(t.dashstyle)n.strokeNode==null?n.strokeNode=f("stroke",[0,0,0,0],{dashstyle:t.dashstyle},e,r):n.strokeNode.dashstyle=t.dashstyle;else if(t["stroke-dasharray"]&&t.lineWidth){var u=t["stroke-dasharray"].indexOf(",")==-1?" ":",",l=t["stroke-dasharray"].split(u),c="";for(var p=0;p<l.length;p++)c+=Math.floor(l[p]/t.lineWidth)+u;n.strokeNode==null?n.strokeNode=f("stroke",[0,0,0,0],{dashstyle:c},e,r):n.strokeNode.dashstyle=c}a(e,i)},d=function(){var e=this;jsPlumb.jsPlumbUIComponent.apply(this,arguments),this.opacityNodes={stroke:null,fill:null},this.initOpacityNodes=function(t){e.opacityNodes.stroke=f("stroke",[0,0,1,1],{opacity:"0.0"},t,e._jsPlumb),e.opacityNodes.fill=f("fill",[0,0,1,1],{opacity:"0.0"},t,e._jsPlumb)},this.setOpacity=function(t,n){var r=e.opacityNodes[t];r&&(r.opacity=""+n)};var t=[];this.getDisplayElements=function(){return t},this.appendDisplayElement=function(n,r){r||e.canvas.parentNode.appendChild(n),t.push(n)}},v=jsPlumb.VmlConnector=function(t){var n=this;n.strokeNode=null,n.canvas=null,d.apply(this,arguments);var r=n._jsPlumb.connectorClass+(t.cssClass?" "+t.cssClass:"");this.paint=function(i,o,u){if(o!=null){var c=n.getPath(i),h={path:c};if(o.outlineColor){var d=o.outlineWidth||1,v=o.lineWidth+2*d,m={strokeStyle:jsPlumbUtil.convertStyle(o.outlineColor),lineWidth:v};for(var g in e)m[g]=o[g];n.bgCanvas==null?(h["class"]=r,h.coordsize=i[2]*s+","+i[3]*s,n.bgCanvas=f("shape",i,h,t.parent,n._jsPlumb,!0),l(n.bgCanvas,i,n.getZIndex()),n.appendDisplayElement(n.bgCanvas,!0),n.attachListeners(n.bgCanvas,n),n.initOpacityNodes(n.bgCanvas,["stroke"])):(h.coordsize=i[2]*s+","+i[3]*s,l(n.bgCanvas,i,n.getZIndex()),a(n.bgCanvas,h)),p(n.bgCanvas,m,n)}n.canvas==null?(h["class"]=r,h.coordsize=i[2]*s+","+i[3]*s,n.tooltip&&(h.label=n.tooltip),n.canvas=f("shape",i,h,t.parent,n._jsPlumb,!0),n.appendDisplayElement(n.canvas,!0),n.attachListeners(n.canvas,n),n.initOpacityNodes(n.canvas,["stroke"])):(h.coordsize=i[2]*s+","+i[3]*s,l(n.canvas,i,n.getZIndex()),a(n.canvas,h)),p(n.canvas,o,n,n._jsPlumb)}},this.reattachListeners=function(){n.canvas&&n.reattachListenersForElement(n.canvas,n)}},m=window.VmlEndpoint=function(e){d.apply(this,arguments);var t=null,n=this,r=null,i=null;n.canvas=document.createElement("div"),n.canvas.style.position="absolute";var s=n._jsPlumb.endpointClass+(e.cssClass?" "+e.cssClass:"");e._jsPlumb.appendElement(n.canvas,e.parent),n.tooltip&&n.canvas.setAttribute("label",n.tooltip),this.paint=function(e,r,i){var o={};jsPlumb.sizeCanvas(n.canvas,e[0],e[1],e[2],e[3]),t==null?(o["class"]=s,t=n
.getVml([0,0,e[2],e[3]],o,i,n.canvas,n._jsPlumb),n.attachListeners(t,n),n.appendDisplayElement(t,!0),n.appendDisplayElement(n.canvas,!0),n.initOpacityNodes(t,["fill"])):(l(t,[0,0,e[2],e[3]]),a(t,o)),p(t,r,n)},this.reattachListeners=function(){t&&n.reattachListenersForElement(t,n)}};jsPlumb.Connectors.vml.Bezier=function(){jsPlumb.Connectors.Bezier.apply(this,arguments),v.apply(this,arguments),this.getPath=function(e){return"m"+c(e[4])+","+c(e[5])+" c"+c(e[8])+","+c(e[9])+","+c(e[10])+","+c(e[11])+","+c(e[6])+","+c(e[7])+" e"}},jsPlumb.Connectors.vml.Straight=function(){jsPlumb.Connectors.Straight.apply(this,arguments),v.apply(this,arguments),this.getPath=function(e){return"m"+c(e[4])+","+c(e[5])+" l"+c(e[6])+","+c(e[7])+" e"}},jsPlumb.Connectors.vml.Flowchart=function(){jsPlumb.Connectors.Flowchart.apply(this,arguments),v.apply(this,arguments),this.getPath=function(e){var t="m "+c(e[4])+","+c(e[5])+" l";for(var n=0;n<e[8];n++)t=t+" "+c(e[9+n*2])+","+c(e[10+n*2]);return t=t+" "+c(e[6])+","+c(e[7])+" e",t}},jsPlumb.Endpoints.vml.Dot=function(){jsPlumb.Endpoints.Dot.apply(this,arguments),m.apply(this,arguments),this.getVml=function(e,t,n,r,i){return f("oval",e,t,r,i)}},jsPlumb.Endpoints.vml.Rectangle=function(){jsPlumb.Endpoints.Rectangle.apply(this,arguments),m.apply(this,arguments),this.getVml=function(e,t,n,r,i){return f("rect",e,t,r,i)}},jsPlumb.Endpoints.vml.Image=jsPlumb.Endpoints.Image,jsPlumb.Endpoints.vml.Blank=jsPlumb.Endpoints.Blank,jsPlumb.Overlays.vml.Label=jsPlumb.Overlays.Label,jsPlumb.Overlays.vml.Custom=jsPlumb.Overlays.Custom;var g=function(e,t){e.apply(this,t),d.apply(this,t);var n=this,r=null;n.canvas=null,n.isAppendedAtTopLevel=!0;var i=function(e,t){return"m "+c(e.hxy.x)+","+c(e.hxy.y)+" l "+c(e.tail[0].x)+","+c(e.tail[0].y)+" "+c(e.cxy.x)+","+c(e.cxy.y)+" "+c(e.tail[1].x)+","+c(e.tail[1].y)+" x e"};this.paint=function(e,t,r,o,u,c){var h={};o&&(h.stroked="true",h.strokecolor=jsPlumbUtil.convertStyle(o,!0)),r&&(h.strokeweight=r+"px"),u&&(h.filled="true",h.fillcolor=u);var p=Math.min(t.hxy.x,t.tail[0].x,t.tail[1].x,t.cxy.x),d=Math.min(t.hxy.y,t.tail[0].y,t.tail[1].y,t.cxy.y),v=Math.max(t.hxy.x,t.tail[0].x,t.tail[1].x,t.cxy.x),m=Math.max(t.hxy.y,t.tail[0].y,t.tail[1].y,t.cxy.y),g=Math.abs(v-p),y=Math.abs(m-d),b=[p,d,g,y];h.path=i(t,c),h.coordsize=c[2]*s+","+c[3]*s,b[0]=c[0],b[1]=c[1],b[2]=c[2],b[3]=c[3],n.canvas==null?(n.canvas=f("shape",b,h,e.canvas.parentNode,e._jsPlumb,!0),e.appendDisplayElement(n.canvas,!0),n.attachListeners(n.canvas,e),n.attachListeners(n.canvas,n)):(l(n.canvas,b),a(n.canvas,h))},this.reattachListeners=function(){n.canvas&&n.reattachListenersForElement(n.canvas,n)},this.cleanup=function(){n.canvas!=null&&jsPlumb.CurrentLibrary.removeElement(n.canvas)}};jsPlumb.Overlays.vml.Arrow=function(){g.apply(this,[jsPlumb.Overlays.Arrow,arguments])},jsPlumb.Overlays.vml.PlainArrow=function(){g.apply(this,[jsPlumb.Overlays.PlainArrow,arguments])},jsPlumb.Overlays.vml.Diamond=function(){g.apply(this,[jsPlumb.Overlays.Diamond,arguments])}}(),function(){var e={joinstyle:"stroke-linejoin","stroke-linejoin":"stroke-linejoin","stroke-dashoffset":"stroke-dashoffset","stroke-linecap":"stroke-linecap"},t="stroke-dasharray",n="dashstyle",r="linearGradient",i="radialGradient",s="fill",o="stop",u="stroke",a="stroke-width",f="style",l="none",c="jsplumb_gradient_",h="lineWidth",p={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml"},d=function(e,t){for(var n in t)e.setAttribute(n,""+t[n])},v=function(e,t){var n=document.createElementNS(p.svg,e);return t=t||{},t.version="1.1",t.xmlns=p.xhtml,d(n,t),n},m=function(e){return"position:absolute;left:"+e[0]+"px;top:"+e[1]+"px"},g=function(e){for(var t=0;t<e.childNodes.length;t++)(e.childNodes[t].tagName==r||e.childNodes[t].tagName==i)&&e.removeChild(e.childNodes[t])},y=function(e,t,n,a,l){var h=c+l._jsPlumb.idstamp();g(e);if(!n.gradient.offset){var p=v(r,{id:h,gradientUnits:"userSpaceOnUse"});e.appendChild(p)}else{var p=v(i,{id:h});e.appendChild(p)}for(var d=0;d<n.gradient.stops.length;d++){var m=d;a.length==8?m=a[4]<a[6]?d:n.gradient.stops.length-1-d:m=a[4]<a[6]?n.gradient.stops.length-1-d:d;var y=jsPlumbUtil.convertStyle(n.gradient.stops[m][1],!0),b=v(o,{offset:Math.floor(n.gradient.stops[d][0]*100)+"%","stop-color":y});p.appendChild(b)}var w=n.strokeStyle?u:s;t.setAttribute(f,w+":url(#"+h+")")},b=function(r,i,o,c,p){o.gradient?y(r,i,o,c,p):(g(r),i.setAttribute(f,"")),i.setAttribute(s,o.fillStyle?jsPlumbUtil.convertStyle(o.fillStyle,!0):l),i.setAttribute(u,o.strokeStyle?jsPlumbUtil.convertStyle(o.strokeStyle,!0):l),o.lineWidth&&i.setAttribute(a,o.lineWidth);if(o[n]&&o[h]&&!o[t]){var d=o[n].indexOf(",")==-1?" ":",",v=o[n].split(d),m="";v.forEach(function(e){m+=Math.floor(e*o.lineWidth)+d}),i.setAttribute(t,m)}else o[t]&&i.setAttribute(t,o[t]);for(var b in e)o[b]&&i.setAttribute(e[b],o[b])},w=function(e){var t=/([0-9].)(p[xt])\s(.*)/,n=e.match(t);return{size:n[1]+n[2],font:n[3]}},E=function(e,t,n){var r=n.split(" "),i=e.className,s=i.baseVal.split(" ");for(var o=0;o<r.length;o++)if(t)s.indexOf(r[o])==-1&&s.push(r[o]);else{var u=s.indexOf(r[o]);u!=-1&&s.splice(u,1)}e.className.baseVal=s.join(" ")},S=function(e,t){E(e,!0,t)},x=function(e,t){E(e,!1,t)};jsPlumbUtil.svg={addClass:S,removeClass:x,node:v,attr:d,pos:m};var T=function(e){var t=this,n=e.pointerEventsSpec||"all";jsPlumb.jsPlumbUIComponent.apply(this,e.originalArgs),t.canvas=null,t.path=null,t.svg=null;var r=e.cssClass+" "+(e.originalArgs[0].cssClass||""),i={style:"",width:0,height:0,"pointer-events":n,position:"absolute"};t.tooltip&&(i.title=t.tooltip),t.svg=v("svg",i),e.useDivWrapper?(t.canvas=document.createElement("div"),t.canvas.style.position="absolute",jsPlumb.sizeCanvas(t.canvas,0,0,1,1),t.canvas.className=r,t.tooltip&&t.canvas.setAttribute("title",t.tooltip)):(d(t.svg,{"class":r}),t.canvas=t.svg),e._jsPlumb.appendElement(t.canvas,e.originalArgs[0].parent),e.useDivWrapper&&t.canvas.appendChild(t.svg);var s=[t.canvas];this.getDisplayElements=function(){return s},this.appendDisplayElement=function(e){s.push(e)},this.paint=function(n,r,i){if(r!=null){var s=n[0],o=n[1];e.useDivWrapper&&(jsPlumb.sizeCanvas(t.canvas,n[0],n[1],n[2],n[3]),s=0,o=0);var u=m([s,o,n[2],n[3]]);t.getZIndex()&&(u+=";z-index:"+t.getZIndex()+";"),d(t.svg,{style:u,width:n[2],height:n[3]}),t._paint.apply(this,arguments)}}},N=jsPlumb.SvgConnector=function(e){var t=this;T.apply(this,[{cssClass:e._jsPlumb.connectorClass,originalArgs:arguments,pointerEventsSpec:"none",tooltip:e.tooltip,_jsPlumb:e._jsPlumb}]),this._paint=function(e,n){var r=t.getPath(e),i={d:r},s=null;i["pointer-events"]="all";if(n.outlineColor){var o=n.outlineWidth||1,u=n.lineWidth+2*o,s=jsPlumb.CurrentLibrary.extend({},n);s.strokeStyle=jsPlumbUtil.convertStyle(n.outlineColor),s.lineWidth=u,t.bgPath==null?(t.bgPath=v("path",i),t.svg.appendChild(t.bgPath),t.attachListeners(t.bgPath,t)):d(t.bgPath,i),b(t.svg,t.bgPath,s,e,t)}t.path==null?(t.path=v("path",i),t.svg.appendChild(t.path),t.attachListeners(t.path,t)):d(t.path,i),b(t.svg,t.path,n,e,t)},this.reattachListeners=function(){t.bgPath&&t.reattachListenersForElement(t.bgPath,t),t.path&&t.reattachListenersForElement(t.path,t)}};jsPlumb.Connectors.svg.Bezier=function(e){jsPlumb.Connectors.Bezier.apply(this,arguments),N.apply(this,arguments),this.getPath=function(e){var t="M "+e[4]+" "+e[5];return t+=" C "+e[8]+" "+e[9]+" "+e[10]+" "+e[11]+" "+e[6]+" "+e[7],t}},jsPlumb.Connectors.svg.Straight=function(e){jsPlumb.Connectors.Straight.apply(this,arguments),N.apply(this,arguments),this.getPath=function(e){return"M "+e[4]+" "+e[5]+" L "+e[6]+" "+e[7]}},jsPlumb.Connectors.svg.Flowchart=function(){var e=this;jsPlumb.Connectors.Flowchart.apply(this,arguments),N.apply(this,arguments),this.getPath=function(t){var n="M "+t[4]+","+t[5],r=t[4],i=t[5];for(var s=0;s<t[8];s++){var o=t[9+s*2],u=t[10+s*2],a=t[9+(s+1)*2],f=t[10+(s+1)*2],l=o!=r&&u==i,c=o==r&&u!=i,h=l?o>a?1:-1:0,p=c?u>f?1:-1:0,d=e.lineWidth/2;n=n+" L "+o+" "+u,n=n+" L "+(o+h*d)+" "+(u+p*d),r=o,i=u,n=n+" M "+o+" "+u}return n=n+" L "+t[6]+","+t[7],n}};var C=window.SvgEndpoint=function(e){var t=this;T.apply(this,[{cssClass:e._jsPlumb.endpointClass,originalArgs:arguments,pointerEventsSpec:"all",useDivWrapper:!0,_jsPlumb:e._jsPlumb}]),this._paint=function(e,n){var r=jsPlumb.extend({},n);r.outlineColor&&(r.strokeWidth=r.outlineWidth,r.strokeStyle=jsPlumbUtil.convertStyle(r.outlineColor,!0)),t.node==null&&(t.node=t.makeNode(e,r),t.svg.appendChild(t.node),t.attachListeners(t.node,t)),b(t.svg,t.node,r,e,t),m(t.node,e)},this.reattachListeners=function(){t.node&&t.reattachListenersForElement(t.node,t)}};jsPlumb.Endpoints.svg.Dot=function(){jsPlumb.Endpoints.Dot.apply(this,arguments),C.apply(this,arguments),this.makeNode=function(e,t){return v("circle",{cx:e[2]/2,cy:e[3]/2,r:e[2]/2})}},jsPlumb.Endpoints.svg.Rectangle=function(){jsPlumb.Endpoints.Rectangle.apply(this,arguments),C.apply(this,arguments),this.makeNode=function(e,t){return v("rect",{width:e[2],height:e[3]})}},jsPlumb.Endpoints.svg.Image=jsPlumb.Endpoints.Image,jsPlumb.Endpoints.svg.Blank=jsPlumb.Endpoints.Blank,jsPlumb.Overlays.svg.Label=jsPlumb.Overlays.Label,jsPlumb.Overlays.svg.Custom=jsPlumb.Overlays.Custom;var k=function(e,t){e.apply(this,t),jsPlumb.jsPlumbUIComponent.apply(this,t),this.isAppendedAtTopLevel=!1;var n=this,r=null;this.paint=function(e,s,o,u,a){r==null&&(r=v("path",{"pointer-events":"all"}),e.svg.appendChild(r),n.attachListeners(r,e),n.attachListeners(r,n));var f=t&&t.length==1?t[0].cssClass||"":"";d(r,{d:i(s),"class":f,stroke:u?u:null,fill:a?a:null})};var i=function(e){return"M"+e.hxy.x+","+e.hxy.y+" L"+e.tail[0].x+","+e.tail[0].y+" L"+e.cxy.x+","+e.cxy.y+" L"+e.tail[1].x+","+e.tail[1].y+" L"+e.hxy.x+","+e.hxy.y};this.reattachListeners=function(){r&&n.reattachListenersForElement(r,n)},this.cleanup=function(){r!=null&&jsPlumb.CurrentLibrary.removeElement(r)}};jsPlumb.Overlays.svg.Arrow=function(){k.apply(this,[jsPlumb.Overlays.Arrow,arguments])},jsPlumb.Overlays.svg.PlainArrow=function(){k.apply(this,[jsPlumb.Overlays.PlainArrow,arguments])},jsPlumb.Overlays.svg.Diamond=function(){k.apply(this,[jsPlumb.Overlays.Diamond,arguments])},jsPlumb.Overlays.svg.GuideLines=function(){var e=null,t=this,n=null,r,i;jsPlumb.Overlays.GuideLines.apply(this,arguments),this.paint=function(n,o,u,a,f){e==null&&(e=v("path"),n.svg.appendChild(e),t.attachListeners(e,n),t.attachListeners(e,t),r=v("path"),n.svg.appendChild(r),t.attachListeners(r,n),t.attachListeners(r,t),i=v("path"),n.svg.appendChild(i),t.attachListeners(i,n),t.attachListeners(i,t)),d(e,{d:s(o[0],o[1]),stroke:"red",fill:null}),d(r,{d:s(o[2][0],o[2][1]),stroke:"blue",fill:null}),d(i,{d:s(o[3][0],o[3][1]),stroke:"green",fill:null})};var s=function(e,t){return"M "+e.x+","+e.y+" L"+t.x+","+t.y}}}(),function(){var e=null,t=function(e,t){return jsPlumb.CurrentLibrary.hasClass(n(e),t)},n=function(e){return jsPlumb.CurrentLibrary.getElementObject(e)},r=function(e){return jsPlumb.CurrentLibrary.getOffset(n(e))},i=function(e){return jsPlumb.CurrentLibrary.getPageXY(e)},s=function(e){return jsPlumb.CurrentLibrary.getClientXY(e)},o=function(){var o=this;o.overlayPlacements=[],jsPlumb.jsPlumbUIComponent.apply(this,arguments),jsPlumbUtil.EventGenerator.apply(this,arguments),this._over=function(e){var t=r(n(o.canvas)),s=i(e),u=s[0]-t.left,a=s[1]-t.top;if(u>0&&a>0&&u<o.canvas.width&&a<o.canvas.height){for(var f=0;f<o.overlayPlacements.length;f++){var l=o.overlayPlacements[f];if(l&&l[0]<=u&&l[1]>=u&&l[2]<=a&&l[3]>=a)return!0}var c=o.canvas.getContext("2d").getImageData(parseInt(u),parseInt(a),1,1);return c.data[0]!=0||c.data[1]!=0||c.data[2]!=0||c.data[3]!=0}return!1};var u=!1,a=!1,f=null,l=!1,c=function(e,n){return e!=null&&t(e,n)};this.mousemove=function(t){var n=i(t),r=s(t),a=document.elementFromPoint(r[0],r[1]),f=c(a,"_jsPlumb_overlay"),l=e==null&&(c(a,"_jsPlumb_endpoint")||c(a,"_jsPlumb_connector"));if(!u&&l&&o._over(t))return u=!0,o.fire("mouseenter",o,t),!0;u&&(!o._over(t)||!l)&&!f&&(u=!1,o.fire("mouseexit",o,t)),o.fire("mousemove",o,t)},this.click=function(e){u&&o._over(e)&&!l&&o.fire("click",o,e),l=!1},this.dblclick=function(e){u&&o._over(e)&&!l&&o.fire("dblclick",o,e),l=!1},this.mousedown=function(e){o._over(e)&&!a&&(a=!0,f=r(n(o.canvas)),o.fire("mousedown",o,e))},this.mouseup=function(e){a=!1,o.fire("mouseup",o,e)},this.contextmenu=function(e){u&&o._over(e)&&!l&&o.fire("contextmenu",o,e),l=!1}},u=function(e){var t=document.createElement("canvas");return e._jsPlumb.appendElement(t,e.parent),t.style.position="absolute",e["class"]&&(t.className=e["class"]),e._jsPlumb.getId(t,e.uuid),e.tooltip&&t.setAttribute("title",e.tooltip),t},a=function(e){o.apply(this,arguments);var t=[];this.getDisplayElements=function(){return t},this.appendDisplayElement=function(e){t.push(e)}},f=jsPlumb.CanvasConnector=function(e){a.apply(this,arguments);var t=function(e,t){n.ctx.save(),jsPlumb.extend(n.ctx,t);if(t.gradient){var r=n.createGradient(e,n.ctx);for(var i=0;i<t.gradient.stops.length;i++)r.addColorStop(t.gradient.stops[i][0],t.gradient.stops[i][1]);n.ctx.strokeStyle=r}n._paint(e,t),n.ctx.restore()},n=this,r=n._jsPlumb.connectorClass+" "+(e.cssClass||"");n.canvas=u({"class":r,_jsPlumb:n._jsPlumb,parent:e.parent,tooltip:e.tooltip}),n.ctx=n.canvas.getContext("2d"),n.appendDisplayElement(n.canvas),n.paint=function(e,r){if(r!=null){jsPlumb.sizeCanvas(n.canvas,e[0],e[1],e[2],e[3]),n.getZIndex()&&(n.canvas.style.zIndex=n.getZIndex());if(r.outlineColor!=null){var i=r.outlineWidth||1,s=r.lineWidth+2*i,o={strokeStyle:r.outlineColor,lineWidth:s};t(e,o)}t(e,r)}}},l=function(e){var t=this;a.apply(this,arguments);var n=t._jsPlumb.endpointClass+" "+(e.cssClass||""),r={"class":n,_jsPlumb:t._jsPlumb,parent:e.parent,tooltip:t.tooltip};t.canvas=u(r),t.ctx=t.canvas.getContext("2d"),t.appendDisplayElement(t.canvas),this.paint=function(e,n,r){jsPlumb.sizeCanvas(t.canvas,e[0],e[1],e[2],e[3]);if(n.outlineColor!=null)var i=n.outlineWidth||1,s=n.lineWidth+2*i,o={strokeStyle:n.outlineColor,lineWidth:s};t._paint.apply(this,arguments)}};jsPlumb.Endpoints.canvas.Dot=function(e){jsPlumb.Endpoints.Dot.apply(this,arguments),l.apply(this,arguments);var t=this,n=function(e){try{return parseInt(e)}catch(t){if(e.substring(e.length-1)=="%")return parseInt(e.substring(0,e-1))}},r=function(e){var r=t.defaultOffset,i=t.defaultInnerRadius;return e.offset&&(r=n(e.offset)),e.innerRadius&&(i=n(e.innerRadius)),[r,i]};this._paint=function(e,n,i){if(n!=null){var s=t.canvas.getContext("2d"),o=i.getOrientation(t);jsPlumb.extend(s,n);if(n.gradient){var u=r(n.gradient),a=o[1]==1?u[0]*-1:u[0],f=o[0]==1?u[0]*-1:u[0],l=s.createRadialGradient(e[4],e[4],e[4],e[4]+f,e[4]+a,u[1]);for(var c=0;c<n.gradient.stops.length;c++)l.addColorStop(n.gradient.stops[c][0],n.gradient.stops[c][1]);s.fillStyle=l}s.beginPath(),s.arc(e[4],e[4],e[4],0,Math.PI*2,!0),s.closePath(),(n.fillStyle||n.gradient)&&s.fill(),n.strokeStyle&&s.stroke()}}},jsPlumb.Endpoints.canvas.Rectangle=function(e){var t=this;jsPlumb.Endpoints.Rectangle.apply(this,arguments),l.apply(this,arguments),this._paint=function(e,n,r){var i=t.canvas.getContext("2d"),s=r.getOrientation(t);jsPlumb.extend(i,n);if(n.gradient){var o=s[1]==1?e[3]:s[1]==0?e[3]/2:0,u=s[1]==-1?e[3]:s[1]==0?e[3]/2:0,a=s[0]==1?e[2]:s[0]==0?e[2]/2:0,f=s[0]==-1?e[2]:s[0]==0?e[2]/2:0,l=i.createLinearGradient(a,o,f,u);for(var c=0;c<n.gradient.stops.length;c++)l.addColorStop(n.gradient.stops[c][0],n.gradient.stops[c][1]);i.fillStyle=l}i.beginPath(),i.rect(0,0,e[2],e[3]),i.closePath(),(n.fillStyle||n.gradient)&&i.fill(),n.strokeStyle&&i.stroke()}},jsPlumb.Endpoints.canvas.Triangle=function(e){var t=this;jsPlumb.Endpoints.Triangle.apply(this,arguments),l.apply(this,arguments),this._paint=function(e,n,r){var i=e[2],s=e[3],o=e[0],u=e[1],a=t.canvas.getContext("2d"),f=0,l=0,c=0,h=r.getOrientation(t);h[0]==1&&(f=i,l=s,c=180),h[1]==-1&&(f=i,c=90),h[1]==1&&(l=s,c=-90),a.fillStyle=n.fillStyle,a.translate(f,l),a.rotate(c*Math.PI/180),a.beginPath(),a.moveTo(0,0),a.lineTo(i/2,s/2),a.lineTo(0,s),a.closePath(),(n.fillStyle||n.gradient)&&a.fill(),n.strokeStyle&&a.stroke()}},jsPlumb.Endpoints.canvas.Image=jsPlumb.Endpoints.Image,jsPlumb.Endpoints.canvas.Blank=jsPlumb.Endpoints.Blank,jsPlumb.Connectors.canvas.Bezier=function(){var e=this;jsPlumb.Connectors.Bezier.apply(this,arguments),f.apply(this,arguments),this._paint=function(t,n){e.ctx.beginPath(),e.ctx.moveTo(t[4],t[5]),e.ctx.bezierCurveTo(t[8],t[9],t[10],t[11],t[6],t[7]),e.ctx.stroke()},this.createGradient=function(t,n,r){return e.ctx.createLinearGradient(t[6],t[7],t[4],t[5])}},jsPlumb.Connectors.canvas.Straight=function(){var e=this,t=[null,[1,-1],[1,1],[-1,1],[-1,-1]];jsPlumb.Connectors.Straight.apply(this,arguments),f.apply(this,arguments),this._paint=function(n,r){e.ctx.beginPath();if(r.dashstyle&&r.dashstyle.split(" ").length==2){var i=r.dashstyle.split(" ");i.length!=2&&(i=[2,2]);var s=[i[0]*r.lineWidth,i[1]*r.lineWidth],o=(n[6]-n[4])/(n[7]-n[5]),u=jsPlumbUtil.segment([n[4],n[5]],[n[6],n[7]]),a=t[u],f=Math.atan(o),l=Math.sqrt(Math.pow(n[6]-n[4],2)+Math.pow(n[7]-n[5],2)),c=Math.floor(l/(s[0]+s[1])),h=[n[4],n[5]];for(var p=0;p<c;p++){e.ctx.moveTo(h[0],h[1]);var d=h[0]+Math.abs(Math.sin(f)*s[0])*a[0],v=h[1]+Math.abs(Math.cos(f)*s[0])*a[1],m=h[0]+Math.abs(Math.sin(f)*(s[0]+s[1]))*a[0],g=h[1]+Math.abs(Math.cos(f)*(s[0]+s[1]))*a[1];e.ctx.lineTo(d,v),h=[m,g]}e.ctx.moveTo(h[0],h[1]),e.ctx.lineTo(n[6],n[7])}else e.ctx.moveTo(n[4],n[5]),e.ctx.lineTo(n[6],n[7]);e.ctx.stroke()},this.createGradient=function(e,t){return t.createLinearGradient(e[4],e[5],e[6],e[7])}},jsPlumb.Connectors.canvas.Flowchart=function(){var e=this;jsPlumb.Connectors.Flowchart.apply(this,arguments),f.apply(this,arguments),this._paint=function(t,n){e.ctx.beginPath(),e.ctx.moveTo(t[4],t[5]);for(var r=0;r<t[8];r++)e.ctx.lineTo(t[9+r*2],t[10+r*2]);e.ctx.lineTo(t[6],t[7]),e.ctx.stroke()},this.createGradient=function(e,t){return t.createLinearGradient(e[4],e[5],e[6],e[7])}},jsPlumb.Overlays.canvas.Label=jsPlumb.Overlays.Label,jsPlumb.Overlays.canvas.Custom=jsPlumb.Overlays.Custom;var c=function(){jsPlumb.jsPlumbUIComponent.apply(this,arguments)},h=function(e,t){e.apply(this,t),c.apply(this,t),this.paint=function(e,t,n,r,i){var s=e.ctx;s.lineWidth=n,s.beginPath(),s.moveTo(t.hxy.x,t.hxy.y),s.lineTo(t.tail[0].x,t.tail[0].y),s.lineTo(t.cxy.x,t.cxy.y),s.lineTo(t.tail[1].x,t.tail[1].y),s.lineTo(t.hxy.x,t.hxy.y),s.closePath(),r&&(s.strokeStyle=r,s.stroke()),i&&(s.fillStyle=i,s.fill())}};jsPlumb.Overlays.canvas.Arrow=function(){h.apply(this,[jsPlumb.Overlays.Arrow,arguments])},jsPlumb.Overlays.canvas.PlainArrow=function(){h.apply(this,[jsPlumb.Overlays.PlainArrow,arguments])},jsPlumb.Overlays.canvas.Diamond=function(){h.apply(this,[jsPlumb.Overlays.Diamond,arguments])}}(),function(e){jsPlumb.CurrentLibrary={addClass:function(e,t){e=jsPlumb.CurrentLibrary.getElementObject(e);try{e[0].className.constructor==SVGAnimatedString&&jsPlumbUtil.svg.addClass(e[0],t)}catch(n){}e.addClass(t)},animate:function(e,t,n){e.animate(t,n)},appendElement:function(e,t){jsPlumb.CurrentLibrary.getElementObject(t).append(e)},ajax:function(t){t=t||{},t.type=t.type||"get",e.ajax(t)},bind:function(e,t,n){e=jsPlumb.CurrentLibrary.getElementObject(e),e.bind(t,n)},dragEvents:{start:"start",stop:"stop",drag:"drag",step:"step",over:"over",out:"out",drop:"drop",complete:"complete"},extend:function(t,n){return e.extend(t,n)},getAttribute:function(e,t){return e.attr(t)},getClientXY:function(e){return[e.clientX,e.clientY]},getDragObject:function(e){return e[1].draggable},getDragScope:function(e){return e.draggable("option","scope")},getDropEvent:function(e){return e[0]},getDropScope:function(e){return e.droppable("option","scope")},getDOMElement:function(e){return typeof e=="string"?document.getElementById(e):e.context||e.length!=null?e[0]:e},getElementObject:function(t){return typeof t=="string"?e("#"+t):e(t)},getOffset:function(e){return e.offset()},getOriginalEvent:function(e){return e.originalEvent},getPageXY:function(e){return[e.pageX,e.pageY]},getParent:function(e){return jsPlumb.CurrentLibrary.getElementObject(e).parent()},getScrollLeft:function(e){return e.scrollLeft()},getScrollTop:function(e){return e.scrollTop()},getSelector:function(t){return e(t)},getSize:function(e){return[e.outerWidth(),e.outerHeight()]},getTagName:function(e){var t=jsPlumb.CurrentLibrary.getElementObject(e);return t.length>0?t[0].tagName:null},getUIPosition:function(e,t){t=t||1;if(e.length==1)ret={left:e[0].pageX,top:e[0].pageY};else{var n=e[1],r=n.offset;ret=r||n.absolutePosition,n.position.left/=t,n.position.top/=t}return{left:ret.left/t,top:ret.top/t}},hasClass:function(e,t){return e.hasClass(t)},initDraggable:function(e,t,n){t=t||{},t.helper=null,n&&(t.scope=t.scope||jsPlumb.Defaults.Scope),e.draggable(t)},initDroppable:function(e,t){t.scope=t.scope||jsPlumb.Defaults.Scope,e.droppable(t)},isAlreadyDraggable:function(e){return e=jsPlumb.CurrentLibrary.getElementObject(e),e.hasClass("ui-draggable")},isDragSupported:function(e,t){return e.draggable},isDropSupported:function(e,t){return e.droppable},removeClass:function(e,t){e=jsPlumb.CurrentLibrary.getElementObject(e);try{e[0].className.constructor==SVGAnimatedString&&jsPlumbUtil.svg.removeClass(e[0],t)}catch(n){}e.removeClass(t)},removeElement:function(e,t){jsPlumb.CurrentLibrary.getElementObject(e).remove()},setAttribute:function(e,t,n){e.attr(t,n)},setDraggable:function(e,t){e.draggable("option","disabled",!t)},setDragScope:function(e,t){e.draggable("option","scope",t)},setOffset:function(e,t){jsPlumb.CurrentLibrary.getElementObject(e).offset(t)},trigger:function(e,t,n){var r=jQuery._data(jsPlumb.CurrentLibrary.getElementObject(e)[0],"handle");r(n)},unbind:function(e,t,n){e=jsPlumb.CurrentLibrary.getElementObject(e),e.unbind(t,n)}},e(document).ready(jsPlumb.init)}(jQuery),function(){"undefined"==typeof Math.sgn&&(Math.sgn=function(e){return 0==e?0:0<e?1:-1});var e={subtract:function(e,t){return{x:e.x-t.x,y:e.y-t.y}},dotProduct:function(e,t){return e.x*t.x+e.y*t.y},square:function(e){return Math.sqrt(e.x*e.x+e.y*e.y)},scale:function(e,t){return{x:e.x*t,y:e.y*t}}},t=Math.pow(2,-65),n=function(t,n){for(var s=[],o=n.length-1,u=2*o-1,a=[],f=[],l=[],c=[],h=[[1,.6,.3,.1],[.4,.6,.6,.4],[.1,.3,.6,1]],p=0;p<=o;p++)a[p]=e.subtract(n[p],t);for(p=0;p<=o-1;p++)f[p]=e.subtract(n[p+1],n[p]),f[p]=e.scale(f[p],3);for(p=0;p<=o-1;p++)for(var d=0;d<=o;d++)l[p]||(l[p]=[]),l[p][d]=e.dotProduct(f[p],a[d]);for(p=0;p<=u;p++)c[p]||(c[p]=[]),c[p].y=0,c[p].x=parseFloat(p)/u;u=o-1;for(a=0;a<=o+u;a++){p=Math.max(0,a-u);for(f=Math.min(a,o);p<=f;p++)j=a-p,c[p+j].y=c[p+j].y+l[j][p]*h[j][p]}o=n.length-1,c=r(c,2*o-1,s,0),u=e.subtract(t,n[0]),l=e.square(u);for(p=h=0;p<c;p++)u=e.subtract(t,i(n,o,s[p],null,null)),u=e.square(u),u<l&&(l=u,h=s[p]);return u=e.subtract(t,n[o]),u=e.square(u),u<l&&(l=u,h=1),{location:h,distance:l}},r=function(e,n,s,o){var u=[],a=[],f=[],l=[],c=0,h,p;p=Math.sgn(e[0].y);for(var d=1;d<=n;d++)h=Math.sgn(e[d].y),h!=p&&c++,p=h;switch(c){case 0:return 0;case 1:if(o>=64)return s[0]=(e[0].x+e[n].x)/2,1;var v,c=e[0].y-e[n].y;p=e[n].x-e[0].x,d=e[0].x*e[n].y-e[n].x*e[0].y,h=max_distance_below=0;for(v=1;v<n;v++){var m=c*e[v].x+p*e[v].y+d;m>h?h=m:m<max_distance_below&&(max_distance_below=m)}v=p,h=(1*(d-h)-v*0)*(1/(0*v-c*1)),v=p,p=d-max_distance_below,c=(1*p-v*0)*(1/(0*v-c*1)),p=Math.min(h,c);if(Math.max(h,c)-p<t)return f=e[n].x-e[0].x,l=e[n].y-e[0].y,s[0]=0+1*(f*(e[0].y-0)-l*(e[0].x-0))*(1/(f*0-l*1)),1}i(e,n,.5,u,a),e=r(u,n,f,o+1),n=r(a,n,l,o+1);for(o=0;o<e;o++)s[o]=f[o];for(o=0;o<n;o++)s[o+e]=l[o];return e+n},i=function(e,t,n,r,i){for(var s=[[]],o=0;o<=t;o++)s[0][o]=e[o];for(e=1;e<=t;e++)for(o=0;o<=t-e;o++)s[e]||(s[e]=[]),s[e][o]||(s[e][o]={}),s[e][o].x=(1-n)*s[e-1][o].x+n*s[e-1][o+1].x,s[e][o].y=(1-n)*s[e-1][o].y+n*s[e-1][o+1].y;if(r!=null)for(o=0;o<=t;o++)r[o]=s[o][0];if(i!=null)for(o=0;o<=t;o++)i[o]=s[t-o][o];return s[t][0]},s={},o=function(e){var t=s[e];if(!t){var t=[],n=function(e){return function(){return e}},r=function(){return function(e){return e}},i=function(){return function(e){return 1-e}},o=function(e){return function(t){for(var n=1,r=0;r<e.length;r++)n*=e[r](t);return n}};t.push(new function(){return function(t){return Math.pow(t,e)}});for(var u=1;u<e;u++){for(var a=[new n(e)],f=0;f<e-u;f++)a.push(new r);for(f=0;f<u;f++)a.push(new i);t.push(new o(a))}t.push(new function(){return function(t){return Math.pow(1-t,e)}}),s[e]=t}return t},u=function(e,t){for(var n=o(e.length-1),r=0,i=0,s=0;s<e.length;s++)r+=e[s].x*n[s](t),i+=e[s].y*n[s](t);return{x:r,y:i}},a=function(e,t,n){for(var r=u(e,t),i=0,s=n>0?1:-1,o=null;i<Math.abs(n);)t+=.005*s,o=u(e,t),i+=Math.sqrt(Math.pow(o.x-r.x,2)+Math.pow(o.y-r.y,2)),r=o;return{point:o,location:t}},f=function(e,t){var n=u(e,t),r=u(e.slice(0,e.length-1),t),i=r.y-n.y,n=r.x-n.x;return i==0?Infinity:Math.atan(i/n)};window.jsBezier={distanceFromCurve:n,gradientAtPoint:f,gradientAtPointAlongCurveFrom:function(e,t,n){return t=a(e,t,n),t.location>1&&(t.location=1),t.location<0&&(t.location=0),f(e,t.location)},nearestPointOnCurve:function(e,t){var r=n(e,t);return{point:i(t,t.length-1,r.location,null,null),location:r.location}},pointOnCurve:u,pointAlongCurveFrom:function(e,t,n){return a(e,t,n).point},perpendicularToCurveAt:function(e,t,n,r){return t=a(e,t,r==null?0:r),e=f(e,t.location),r=Math.atan(-1/e),e=n/2*Math.sin(r),n=n/2*Math.cos(r),[{x:t.point.x+n,y:t.point.y+e},{x:t.point.x-n,y:t.point.y-e}]},locationAlongCurveFrom:function(e,t,n){return a(e,t,n).location}}}();